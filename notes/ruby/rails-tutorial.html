<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>rails-tutorial</title>
<!-- 2016-10-11 Tue 03:47 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="your name" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>

         <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono|Galdeano|Open+Sans:600italic,400,600|Roboto+Condensed:400,700" rel="stylesheet" type="text/css">
         <link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="http://harrifeng.github.io/sitemap.html"> UP </a>
 |
 <a accesskey="H" href="http://harrifeng.github.io/index.html"> HOME </a>
</div><div id="preamble" class="status">

         <div id="header">
            <div id="header-top">
                <div id="blog-title">Harrifeng's Path</div>
                <div id="blog-sub-title">纸上得来终觉浅,绝知此事要Coding</div>
            </div>
            <div id="nav">
                <ul>
                    <li><a href="/">首页</a></li>
                    <li><a href="/about.html">About Me</a></li>
                    <li>
                    </li>
                </ul>
            </div>
         </div>
</div>
<div id="content">
<h1 class="title">rails-tutorial</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Chapter 01: From zero to deploy</a>
<ul>
<li><a href="#sec-1-1">Introduction</a>
<ul>
<li><a href="#sec-1-1-1">Comments for various readers</a></li>
<li><a href="#sec-1-1-2">"Scaling" Rails</a></li>
<li><a href="#sec-1-1-3">Conventiions in this book</a></li>
</ul>
</li>
<li><a href="#sec-1-2">Up and running</a>
<ul>
<li><a href="#sec-1-2-1">Development environments</a></li>
<li><a href="#sec-1-2-2">Ruby, RubyGems, Rails, and Git</a></li>
<li><a href="#sec-1-2-3">The first application</a></li>
<li><a href="#sec-1-2-4">Bundler</a></li>
<li><a href="#sec-1-2-5">rails server</a></li>
<li><a href="#sec-1-2-6">Model-view-controller (MVC)</a></li>
</ul>
</li>
<li><a href="#sec-1-3">Version control with Git</a></li>
<li><a href="#sec-1-4">Deploying</a>
<ul>
<li><a href="#sec-1-4-1">Heroku commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">Chapter 02: A demo app</a>
<ul>
<li><a href="#sec-2-1">Planning the application</a>
<ul>
<li><a href="#sec-2-1-1">Modeling demo users</a></li>
<li><a href="#sec-2-1-2">Modeling demo microposts</a></li>
</ul>
</li>
<li><a href="#sec-2-2">The Users resource</a>
<ul>
<li><a href="#sec-2-2-1">A user tour</a></li>
<li><a href="#sec-2-2-2">MVC in action</a></li>
<li><a href="#sec-2-2-3">Weaknesses of this Users resource</a></li>
</ul>
</li>
<li><a href="#sec-2-3">The Microposts resource</a>
<ul>
<li><a href="#sec-2-3-1">A micropost microtour</a></li>
<li><a href="#sec-2-3-2">Putting the micro in microposts</a></li>
<li><a href="#sec-2-3-3">A user has_many microposts</a></li>
<li><a href="#sec-2-3-4">Inheritance hierarchies</a></li>
<li><a href="#sec-2-3-5">Deploying the demo app</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">Chapter 03: Mostly static pages</a>
<ul>
<li><a href="#sec-3-1">Static pages</a></li>
<li><a href="#sec-3-2">Our first tests</a>
<ul>
<li><a href="#sec-3-2-1">Test-driven development</a></li>
<li><a href="#sec-3-2-2">Adding a page</a>
<ul>
<li><a href="#sec-3-2-2-1">Red:</a></li>
</ul>
</li>
<li><a href="#sec-3-2-3">Green</a></li>
<li><a href="#sec-3-2-4">Refactor</a></li>
</ul>
</li>
<li><a href="#sec-3-3">Slightly dynamic pages</a>
<ul>
<li><a href="#sec-3-3-1">Testing a title change</a></li>
<li><a href="#sec-3-3-2">Passing title tests</a></li>
<li><a href="#sec-3-3-3">Embedded Ruby</a></li>
<li><a href="#sec-3-3-4">Eliminating duplication with layouts</a></li>
</ul>
</li>
<li><a href="#sec-3-4">Conclusion</a></li>
</ul>
</li>
<li><a href="#sec-4">Chapter 04: Rails-flavored Ruby</a>
<ul>
<li><a href="#sec-4-1">Motivation</a></li>
<li><a href="#sec-4-2">Strings and methods</a>
<ul>
<li><a href="#sec-4-2-1">Comments</a></li>
<li><a href="#sec-4-2-2">String</a></li>
<li><a href="#sec-4-2-3">Printing</a></li>
<li><a href="#sec-4-2-4">Single-quoted strings</a></li>
<li><a href="#sec-4-2-5">Objects and message passing</a></li>
<li><a href="#sec-4-2-6">Method definitions</a></li>
<li><a href="#sec-4-2-7">Back to the title helper</a></li>
</ul>
</li>
<li><a href="#sec-4-3">Other data structures</a>
<ul>
<li><a href="#sec-4-3-1">Arrays and ranges</a></li>
<li><a href="#sec-4-3-2">Blocks</a></li>
<li><a href="#sec-4-3-3">Hashes and symbols</a></li>
<li><a href="#sec-4-3-4">CSS revisited</a></li>
</ul>
</li>
<li><a href="#sec-4-4">Ruby classes</a>
<ul>
<li><a href="#sec-4-4-1">Constructors</a></li>
<li><a href="#sec-4-4-2">Class inheritance</a></li>
<li><a href="#sec-4-4-3">Modifying built-in classes</a></li>
<li><a href="#sec-4-4-4">A controller class</a></li>
<li><a href="#sec-4-4-5">A user class</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">Chapter 05: Filling in the layout</a>
<ul>
<li><a href="#sec-5-1">Adding some structure</a>
<ul>
<li><a href="#sec-5-1-1">Partials</a></li>
</ul>
</li>
<li><a href="#sec-5-2">Sass and the asset pipeline</a>
<ul>
<li><a href="#sec-5-2-1">The asset pipeline</a>
<ul>
<li><a href="#sec-5-2-1-1">Asset directories</a></li>
<li><a href="#sec-5-2-1-2">Manifest files</a></li>
<li><a href="#sec-5-2-1-3">Preprocessorengines</a></li>
<li><a href="#sec-5-2-1-4">Efficiency in production</a></li>
</ul>
</li>
<li><a href="#sec-5-2-2">Syntactically awesome stylesheets</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Chapter 01: From zero to deploy</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>rails 4.0版本和rails 3.2版本的差距不大. 对本书来说,主要的一个不同是一种新的
安全机制:strong parameters
</li>
<li>本书就是RPG游戏,每一章是一关
</li>
</ul>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Introduction</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>rails成功的要素:
<ul class="org-ul">
<li>100% open source
</li>
<li>在ruby的帮助下,为web开发创建了一种domain-specific language,使得很多操作变
得容易,比如自动生成网页,数据库, url等
</li>
<li>rails core team是一个非常愿意尝试新技术的团队
</li>
<li>社区的壮大,让"Google the error message"变得非常容易
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1">Comments for various readers</h4>
<div class="outline-text-4" id="text-1-1-1">
<ul class="org-ul">
<li>先学习ruby再开始rails
</li>
<li>rails是测试驱动开发,所以,要学会先写测试
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2">"Scaling" Rails</h4>
<div class="outline-text-4" id="text-1-1-2">
<ul class="org-ul">
<li>在你的site大到Hulu或者Yellow Pages之前,不用考虑扩展性
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3">Conventiions in this book</h4>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Up and running</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">Development environments</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li>最常见的IDE是rubymine
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">Ruby, RubyGems, Rails, and Git</h4>
<div class="outline-text-4" id="text-1-2-2">
<ul class="org-ul">
<li>需要使用"完全一致"的软件版本来达到完全一致的效果
</li>
<li>安装ruby的时候,本书使用rvm:
<ol class="org-ol">
<li>安装Command Line Tools for Xcode
</li>
<li>安装RVM
<div class="org-src-container">

<pre class="src src-sh">curl -sSL https://get.rvm.io | bash -s stable
</pre>
</div>
</li>
<li>升级rvm到最稳定版本
<div class="org-src-container">

<pre class="src src-sh">rvm get stable
</pre>
</div>
</li>
<li>rvm再第一次安装后,需要重启terminal,或者
<div class="org-src-container">

<pre class="src src-sh">source ~/.rvm/scripts/rvm
</pre>
</div>
</li>
<li>rvm在编译并安装ruby之前可以使用命令来查看缺少必要的lib
<div class="org-src-container">

<pre class="src src-sh">rvm requirements
</pre>
</div>
</li>
<li>得到缺少的lib信息以后,就需要brew来安装缺失lib
<div class="org-src-container">

<pre class="src src-sh">brew install libtool libxslt libksba openssl
</pre>
</div>
</li>
<li>我们还需要安装libyaml(新版的 rvm requirements 会提示的)
<div class="org-src-container">

<pre class="src src-sh">brew install libyaml
</pre>
</div>
</li>
</ol>
</li>
<li>rvm 搞定以后,下一步就是安装ruby了. 安装的时候,我们要指出OpenSSL的位置
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:rails-tutorial hfeng$ rvm install 2.0.0 --with-openssl-dir=/usr/local/opt/openssl
Checking requirements for osx.
Certificates in '/usr/local/etc/openssl/cert.pem' are already up to date.
Requirements installation successful.
Installing Ruby from source to: /Users/hfeng/.rvm/rubies/ruby-2.0.0-p481, this may take a while depending on your cpu(s)...
ruby-2.0.0-p481 - #downloading ruby-2.0.0-p481, this may take a while depending on your connection...
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 10.2M  100 10.2M    0     0  50421      0  0:03:32  0:03:32 --:--:--  141k
ruby-2.0.0-p481 - #extracting ruby-2.0.0-p481 to /Users/hfeng/.rvm/src/ruby-2.0.0-p481....
ruby-2.0.0-p481 - #configuring.................................................
ruby-2.0.0-p481 - #post-configuration.
ruby-2.0.0-p481 - #compiling................................................................................
ruby-2.0.0-p481 - #installing..............
ruby-2.0.0-p481 - #making binaries executable..
ruby-2.0.0-p481 - #downloading rubygems-2.2.2
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  404k  100  404k    0     0  95267      0  0:00:04  0:00:04 --:--:-- 95285
No checksum for downloaded archive, recording checksum in user configuration.
ruby-2.0.0-p481 - #extracting rubygems-2.2.2....
ruby-2.0.0-p481 - #removing old rubygems.........
$LANG was empty, setting up LANG=en_US, if it fails again try setting LANG to something sane and try again.
ruby-2.0.0-p481 - #installing rubygems-2.2.2...............
ruby-2.0.0-p481 - #gemset created /Users/hfeng/.rvm/gems/ruby-2.0.0-p481@global
ruby-2.0.0-p481 - #importing gemset /Users/hfeng/.rvm/gemsets/global.gems.........................................................
ruby-2.0.0-p481 - #generating global wrappers........
ruby-2.0.0-p481 - #gemset created /Users/hfeng/.rvm/gems/ruby-2.0.0-p481
ruby-2.0.0-p481 - #importing gemsetfile /Users/hfeng/.rvm/gemsets/default.gems evaluated to empty gem list
ruby-2.0.0-p481 - #generating default wrappers........
ruby-2.0.0-p481 - #adjusting #shebangs for (gem irb erb ri rdoc testrb rake).
Install of ruby-2.0.0-p481 - #complete
Ruby was built without documentation, to build it run: rvm docs generate-ri
hfengdeMacBook-Air:rails-tutorial hfeng$ which ruby
/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin/ruby
hfengdeMacBook-Air:rails-tutorial hfeng$ ruby --version
ruby 2.0.0p481 (2014-05-08 revision 45883) [x86_64-darwin13.2.0]
hfengdeMacBook-Air:rails-tutorial hfeng$ rvm list

rvm rubies

=* ruby-2.0.0-p481 [ x86_64 ]

# =&gt; - current
# =* - current &amp;&amp; default
#  * - default

hfengdeMacBook-Air:rails-tutorial hfeng$
</pre>
</div>
</li>
<li>rvm 的ruby是全局的, 创建的gemset也是要依靠某个ruby版本,比如我们创建一个新
的gemset(名字叫railstutorial_rails_4_0), 在这之前一定要指定ruby版本.
创建gemset之后,还可以指定某个gemset为默认的gemset
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:rails-tutorial hfeng$ rvm 2.0.0
hfengdeMacBook-Air:rails-tutorial hfeng$ rvm list

rvm rubies

=* ruby-2.0.0-p481 [ x86_64 ]

# =&gt; - current
# =* - current &amp;&amp; default
#  * - default

hfengdeMacBook-Air:rails-tutorial hfeng$ rvm gemset list

gemsets for ruby-2.0.0-p481 (found in /Users/hfeng/.rvm/gems/ruby-2.0.0-p481)
=&gt; (default)
   global

hfengdeMacBook-Air:rails-tutorial hfeng$ rvm gemset create railstutorial_rails_4_0
ruby-2.0.0-p481 - #gemset created /Users/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0
ruby-2.0.0-p481 - #generating railstutorial_rails_4_0 wrappers........
hfengdeMacBook-Air:rails-tutorial hfeng$ rvm gemset list

gemsets for ruby-2.0.0-p481 (found in /Users/hfeng/.rvm/gems/ruby-2.0.0-p481)
=&gt; (default)
   global
   railstutorial_rails_4_0

hfengdeMacBook-Air:rails-tutorial hfeng$ rvm use 2.0.0@railstutorial_rails_4_0 --default
Using /Users/hfeng/.rvm/gems/ruby-2.0.0-p481 with gemset railstutorial_rails_4_0
hfengdeMacBook-Air:rails-tutorial hfeng$ rvm gemset list

gemsets for ruby-2.0.0-p481 (found in /Users/hfeng/.rvm/gems/ruby-2.0.0-p481)
   (default)
   global
=&gt; railstutorial_rails_4_0
</pre>
</div>
</li>
<li>gem 这个binary是和ruby相关联的,gemset跟着一个特定版本的ruby,也就跟着一个特定版本的gem
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:rails-tutorial hfeng$ which gem
/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin/gem
hfengdeMacBook-Air:rails-tutorial hfeng$ gem --version
2.2.2
</pre>
</div>
</li>
<li>我们要把默认的跟着ruby-2.0.0的gem更改为2.1.9 (本书所选的gem版本)
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:rails-tutorial hfeng$ gem update --system 2.1.9
Updating rubygems-update
Fetching: rubygems-update-2.1.9.gem (100%)
Successfully installed rubygems-update-2.1.9
Installing RubyGems 2.1.9
RubyGems 2.1.9 installed



------------------------------------------------------------------------------

RubyGems installed the following executables:
    /Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin/gem

RubyGems system software updated
hfengdeMacBook-Air:rails-tutorial hfeng$ gem --version
2.1.9
</pre>
</div>
</li>
<li>下面我们要开始gem来安装gems了!为了不安装rdoc和ri,我们可以disable它们,通过
如下设置~/.gemrc
<div class="org-src-container">

<pre class="src src-sh">install: --no-rdoc --no-ri
update: --no-rdoc --no-ri
</pre>
</div>
</li>
<li>在安装第一个gem之前,先确认一下环境
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:rails-tutorial hfeng$ rvm gemset list

gemsets for ruby-2.0.0-p481 (found in /Users/hfeng/.rvm/gems/ruby-2.0.0-p481)
   (default)
   global
=&gt; railstutorial_rails_4_0

hfengdeMacBook-Air:rails-tutorial hfeng$ which gem
/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin/gem
hfengdeMacBook-Air:rails-tutorial hfeng$ rvm info

ruby-2.0.0-p481@railstutorial_rails_4_0:

  system:
    uname:       "Darwin hfengdeMacBook-Air.local 13.2.0 Darwin Kernel Version 13.2.0: Thu Apr 17 23:03:13 PDT 2014; root:xnu-2422.100.13~1/RELEASE_X86_64 x86_64"
    system:      "osx/10.9/x86_64"
    bash:        "/bin/bash =&gt; GNU bash, version 3.2.51(1)-release (x86_64-apple-darwin13)"
    zsh:         "/bin/zsh =&gt; zsh 5.0.2 (x86_64-apple-darwin13.0)"

  rvm:
    version:      "rvm 1.25.28 (stable) by Wayne E. Seguin &lt;wayneeseguin@gmail.com&gt;, Michal Papis &lt;mpapis@gmail.com&gt; [https://rvm.io/]"
    updated:      "7 hours 7 minutes 2 seconds ago"
    path:         "/Users/hfeng/.rvm"

  ruby:
    interpreter:  "ruby"
    version:      "2.0.0p481"
    date:         "2014-05-08"
    platform:     "x86_64-darwin13.2.0"
    patchlevel:   "2014-05-08 revision 45883"
    full_version: "ruby 2.0.0p481 (2014-05-08 revision 45883) [x86_64-darwin13.2.0]"

  homes:
    gem:          "/Users/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0"
    ruby:         "/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481"

  binaries:
    ruby:         "/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin/ruby"
    irb:          "/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin/irb"
    gem:          "/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin/gem"
    rake:         "/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin/rake"

  environment:
    PATH:         "/Users/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/bin:/Users/hfeng/.rvm/gems/ruby-2.0.0-p481@global/bin:/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr:/Users/hfeng/.rvm/bin"
    GEM_HOME:     "/Users/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0"
    GEM_PATH:     "/Users/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0:/Users/hfeng/.rvm/gems/ruby-2.0.0-p481@global"
    MY_RUBY_HOME: "/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481"
    IRBRC:        "/Users/hfeng/.rvm/rubies/ruby-2.0.0-p481/.irbrc"
    RUBYOPT:      ""
    gemset:       "railstutorial_rails_4_0"
</pre>
</div>
</li>
<li>安装第一个gem, rails. 安装完之后确认rails是在gemset ruby-2.0.0-p481@railstutorial_rails_4_0
      里面的
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:rails-tutorial hfeng$ gem install rails --version 4.0.8
Fetching: i18n-0.6.11.gem (100%)
Successfully installed i18n-0.6.11
Fetching: multi_json-1.10.1.gem (100%)
Successfully installed multi_json-1.10.1
Fetching: tzinfo-0.3.40.gem (100%)
Successfully installed tzinfo-0.3.40
Fetching: thread_safe-0.3.4.gem (100%)
Successfully installed thread_safe-0.3.4
Fetching: activesupport-4.0.8.gem (100%)
Successfully installed activesupport-4.0.8
Fetching: builder-3.1.4.gem (100%)
Successfully installed builder-3.1.4
Fetching: rack-1.5.2.gem (100%)
Successfully installed rack-1.5.2
Fetching: rack-test-0.6.2.gem (100%)
Successfully installed rack-test-0.6.2
Fetching: erubis-2.7.0.gem (100%)
Successfully installed erubis-2.7.0
Fetching: actionpack-4.0.8.gem (100%)
Successfully installed actionpack-4.0.8
Fetching: activemodel-4.0.8.gem (100%)
Successfully installed activemodel-4.0.8
Fetching: arel-4.0.2.gem (100%)
Successfully installed arel-4.0.2
Fetching: activerecord-deprecated_finders-1.0.3.gem (100%)
Successfully installed activerecord-deprecated_finders-1.0.3
Fetching: activerecord-4.0.8.gem (100%)
Successfully installed activerecord-4.0.8
Fetching: mime-types-1.25.1.gem (100%)
Successfully installed mime-types-1.25.1
Fetching: polyglot-0.3.5.gem (100%)
Successfully installed polyglot-0.3.5
Fetching: treetop-1.4.15.gem (100%)
Successfully installed treetop-1.4.15
Fetching: mail-2.5.4.gem (100%)
Successfully installed mail-2.5.4
Fetching: actionmailer-4.0.8.gem (100%)
Successfully installed actionmailer-4.0.8
Fetching: thor-0.19.1.gem (100%)
Successfully installed thor-0.19.1
Fetching: railties-4.0.8.gem (100%)
Successfully installed railties-4.0.8
Fetching: hike-1.2.3.gem (100%)
Successfully installed hike-1.2.3
Fetching: tilt-1.4.1.gem (100%)
Successfully installed tilt-1.4.1
Fetching: sprockets-2.12.1.gem (100%)
Successfully installed sprockets-2.12.1
Fetching: sprockets-rails-2.1.3.gem (100%)
Successfully installed sprockets-rails-2.1.3
Fetching: rails-4.0.8.gem (100%)
Successfully installed rails-4.0.8
26 gems installed
hfengdeMacBook-Air:rails-tutorial hfeng$ which rails
/Users/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/bin/rails
hfengdeMacBook-Air:rails-tutorial hfeng$ rails -v
Rails 4.0.8
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3">The first application</h4>
<div class="outline-text-4" id="text-1-2-3">
<ul class="org-ul">
<li>所有的 rails 应用程序都是从 rails new 命令开始的.
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:exam hfeng$ mkdir rails_projects
hfengdeMacBook-Air:exam hfeng$ cd rails_projects/
hfengdeMacBook-Air:rails_projects hfeng$ which rails
/Users/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/bin/rails
hfengdeMacBook-Air:rails_projects hfeng$ rails --version
Rails 4.0.8
hfengdeMacBook-Air:rails_projects hfeng$ rails new first_app
      create
      create  README.rdoc
      create  Rakefile
      create  config.ru
      create  .gitignore
      create  Gemfile
      create  app
      create  app/assets/javascripts/application.js
      create  app/assets/stylesheets/application.css
      create  app/controllers/application_controller.rb
      create  app/helpers/application_helper.rb
      create  app/views/layouts/application.html.erb
      create  app/assets/images/.keep
      create  app/mailers/.keep
      create  app/models/.keep
      create  app/controllers/concerns/.keep
      create  app/models/concerns/.keep
      create  bin
      create  bin/bundle
      create  bin/rails
      create  bin/rake
      create  config
      create  config/routes.rb
      create  config/application.rb
      create  config/environment.rb
      create  config/environments
      create  config/environments/development.rb
      create  config/environments/production.rb
      create  config/environments/test.rb
      create  config/initializers
      create  config/initializers/backtrace_silencers.rb
      create  config/initializers/filter_parameter_logging.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/secret_token.rb
      create  config/initializers/session_store.rb
      create  config/initializers/wrap_parameters.rb
      create  config/locales
      create  config/locales/en.yml
      create  config/boot.rb
      create  config/database.yml
      create  db
      create  db/seeds.rb
      create  lib
      create  lib/tasks
      create  lib/tasks/.keep
      create  lib/assets
      create  lib/assets/.keep
      create  log
      create  log/.keep
      create  public
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/favicon.ico
      create  public/robots.txt
      create  test/fixtures
      create  test/fixtures/.keep
      create  test/controllers
      create  test/controllers/.keep
      create  test/mailers
      create  test/mailers/.keep
      create  test/models
      create  test/models/.keep
      create  test/helpers
      create  test/helpers/.keep
      create  test/integration
      create  test/integration/.keep
      create  test/test_helper.rb
      create  tmp/cache
      create  tmp/cache/assets
      create  vendor/assets/javascripts
      create  vendor/assets/javascripts/.keep
      create  vendor/assets/stylesheets
      create  vendor/assets/stylesheets/.keep
         run  bundle install
Fetching gem metadata from https://rubygems.org/..........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Installing rake 10.3.2
Using i18n 0.6.11
Installing minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using bundler 1.6.4
Installing coffee-script-source 1.7.1
Installing execjs 2.2.1
Installing coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Installing coffee-rails 4.0.1
Using hike 1.2.3
Installing jbuilder 1.5.3
Installing jquery-rails 3.1.1
Installing json 1.8.1
Using tilt 1.4.1
Installing sprockets 2.11.0
Using sprockets-rails 2.1.3
Using rails 4.0.8
Installing rdoc 4.1.1
Installing sass 3.2.19
Installing sass-rails 4.0.3
Installing sdoc 0.4.0
Installing sqlite3 1.3.9
Installing turbolinks 2.2.2
Installing uglifier 2.5.1
Your bundle is complete!
Use `bundle show [gemname]` to see where a bundled gem is installed.
Post-install message from rdoc:
Depending on your version of ruby, you may need to install ruby rdoc/ri data:

&lt;= 1.8.6 : unsupported
 = 1.8.7 : gem install rdoc-data; rdoc-data --install
 = 1.9.1 : gem install rdoc-data; rdoc-data --install
&gt;= 1.9.2 : nothing to do! Yay!
</pre>
</div>
</li>
<li>我们来看看每个 folder 的意义都是什么
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">File/ Directory</th>
<th scope="col" class="left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">app/</td>
<td class="left">Core application code, including models, views, controllers and helpers</td>
</tr>

<tr>
<td class="left">app/assets</td>
<td class="left">Applications assets such as CSS, JavaScript and images</td>
</tr>

<tr>
<td class="left">bin/</td>
<td class="left">Binary executable files</td>
</tr>

<tr>
<td class="left">config/</td>
<td class="left">Application configuration</td>
</tr>

<tr>
<td class="left">db/</td>
<td class="left">Database files</td>
</tr>

<tr>
<td class="left">doc/</td>
<td class="left">Documentation for the application</td>
</tr>

<tr>
<td class="left">lib/</td>
<td class="left">Library modules</td>
</tr>

<tr>
<td class="left">lib/assets</td>
<td class="left">Library assets such as CSS, JavaScript and images</td>
</tr>

<tr>
<td class="left">log/</td>
<td class="left">application log files</td>
</tr>

<tr>
<td class="left">public/</td>
<td class="left">Data accessible to the public, such as error pages</td>
</tr>

<tr>
<td class="left">bin/rails</td>
<td class="left">A program for generating code, opening console sessions, or starting a local server</td>
</tr>

<tr>
<td class="left">test/</td>
<td class="left">Application tests</td>
</tr>

<tr>
<td class="left">tmp/</td>
<td class="left">Temporary files</td>
</tr>

<tr>
<td class="left">vendor</td>
<td class="left">Third-party code such as plugins and gems</td>
</tr>

<tr>
<td class="left">vender/assets</td>
<td class="left">Third-part assets such as CSS, JS, and images</td>
</tr>

<tr>
<td class="left">README.rdoc</td>
<td class="left">A brief description of the application</td>
</tr>

<tr>
<td class="left">Rakefile</td>
<td class="left">Utility tasks available via the rake command</td>
</tr>

<tr>
<td class="left">Gemfile</td>
<td class="left">Gem requirements for this app</td>
</tr>

<tr>
<td class="left">Gemfile.lock</td>
<td class="left">A list of gems used to ensure that all copies of the app use the same gem versions</td>
</tr>

<tr>
<td class="left">config.ru</td>
<td class="left">A configuration file for Rack middleware</td>
</tr>

<tr>
<td class="left">.gitignore</td>
<td class="left">Patterns for files that shoulde be ignored by Git</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4">Bundler</h4>
<div class="outline-text-4" id="text-1-2-4">
<ul class="org-ul">
<li>一般创建rails项目之后,下一个步骤就是安装项目Gemfile里面的gem(通过bundle
install命令).
</li>
<li>不过如果你细心的话,会注意到rails new最后会自动调用run bundle install,所以
我们这里要对Gemfile进行一些更改,然后继续调用bundle来使得更改起效.
</li>
<li>更改大部分是使用版本准确的gem(而不再是一个范围内的gem), 下面是我们做的更改
和原来初始版本的diff
<div class="org-src-container">

<pre class="src src-diff"> source 'https://rubygems.org'
+ruby '2.0.0'
+#ruby-gemsets=railstutorial_rails_4_0

 # Bundle edge Rails instead: gem 'rails', github: 'rails/rails'
 gem 'rails', '4.0.8'

 # Use sqlite3 as the database for Active Record
-gem 'sqlite3'
+group :development do
+  gem 'sqlite3', '1.3.8'
+end

 # Use SCSS for stylesheets
-gem 'sass-rails', '~&gt; 4.0.2'
+gem 'sass-rails', '4.0.1'

 # Use Uglifier as compressor for JavaScript assets
-gem 'uglifier', '&gt;= 1.3.0'
+gem 'uglifier', '2.1.1'

 # Use CoffeeScript for .js.coffee assets and views
-gem 'coffee-rails', '~&gt; 4.0.0'
+gem 'coffee-rails', '4.0.1'

 # See https://github.com/sstephenson/execjs#readme for more supported runtimes
 # gem 'therubyracer', platforms: :ruby

 # Use jquery as the JavaScript library
-gem 'jquery-rails'
+gem 'jquery-rails', '3.0.4'

 # Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks
-gem 'turbolinks'
+gem 'turbolinks', '1.1.1'

 # Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder
-gem 'jbuilder', '~&gt; 1.2'
+gem 'jbuilder', '1.0.2'

 group :doc do
   # bundle exec rake doc:rails generates the API under doc/api.
-  gem 'sdoc', require: false
+  gem 'sdoc', '0.3.20', require: false
 end

 # Use ActiveModel has_secure_password
</pre>
</div>
</li>
<li>开头的两行主要是确定ruby和gemset版本, 如果使用RVM的话,它会来使用的
<div class="org-src-container">

<pre class="src src-ruby">ruby '2.0.0'
#ruby-gemset=railstutorial_rails_4_0
</pre>
</div>
</li>
<li>我们看看diff文件,就会发现很多种Gemfile定义模糊gem文件版本的方法
<ul class="org-ul">
<li>安装大于某个版本的最新版本:比如下面的例子中,只要uglifier最新版本比1.3.0
大,那么就会安装.比如7.2
<div class="org-src-container">

<pre class="src src-ruby">gem 'uglifier', '&gt;= 1.3.0'
</pre>
</div>
</li>
<li>安装某个区间的最新版本:比如下面的例子中, 安装和所列版本的major和minor版
本一样的,最新版本,比如4.0.11
<div class="org-src-container">

<pre class="src src-ruby">gem 'coffee-rails', '~&gt; 4.0.0'
</pre>
</div>
</li>
</ul>
</li>
<li>这一切之后,我们就可以bundle install啦!, 在之前可以先bundle update一下, bundle
update其实是进化版本的的bundle install: bundle update比bundle install多做
了两步:
<ol class="org-ol">
<li>如果Gemfile里面的gem没有设置版本,那么就要把它更新到最新
</li>

<li>如果Gemfile里面的gem设置了模糊版本,比如~&gt;, 那么要更新到其"认可的"最新
</li>
</ol>
</li>
<li>也就是说bundle update更新Gemfile.lock里面版本的可能性很大,因为很可能有gem
会更新,下面的结果印证了我们的判断.
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/first_app$ bundle update
Fetching source index from https://rubygems.org/
Resolving dependencies........................
Using rake 10.3.2
Using i18n 0.6.11
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using bundler 1.6.2
Using coffee-script-source 1.7.1
Using execjs 2.2.1
Using coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Using coffee-rails 4.0.1
Using hike 1.2.3
Installing jbuilder 1.0.2 (was 1.5.3)
Installing jquery-rails 3.0.4 (was 3.1.1)
Using json 1.8.1
Using tilt 1.4.1
Using sprockets 2.12.1 (was 2.11.0)
Installing sprockets-rails 2.0.1 (was 2.1.3)
Using rails 4.0.8
Installing rdoc 3.12.2 (was 4.1.1)
Installing sass 3.3.10 (was 3.2.19)
Installing sass-rails 4.0.1 (was 4.0.3)
Installing sdoc 0.3.20 (was 0.4.0)
Installing sqlite3 1.3.8 (was 1.3.9)
Installing turbolinks 1.1.1 (was 2.2.2)
Installing uglifier 2.1.1 (was 2.5.3)
Your bundle is updated!
</pre>
</div>
</li>
<li>再更新好Gemfile.lock之后,我们就可以开始build install啦. 从log可见,其实在bundle
update的时候,都已经安装好了
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/first_app$ bundle install
Using rake 10.3.2
Using i18n 0.6.11
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using coffee-script-source 1.7.1
Using execjs 2.2.1
Using coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Using coffee-rails 4.0.1
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using bundler 1.6.2
Using tilt 1.4.1
Using sprockets 2.12.1
Using sprockets-rails 2.0.1
Using rails 4.0.8
Using rdoc 3.12.2
Using sass 3.3.10
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using sqlite3 1.3.8
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Use `bundle show [gemname]` to see where a bundled gem is installed.
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-5" class="outline-4">
<h4 id="sec-1-2-5">rails server</h4>
<div class="outline-text-4" id="text-1-2-5">
<ul class="org-ul">
<li>准备都做好之后,就可以开始启动rails server啦! 当然在这之前可能会报一些缺少
javascript runtime的错误apt-get install nodejs就可以了
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/first_app$ rails server
/home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/execjs-2.2.1/lib/execjs/runtimes.rb:51:in `autodetect': Could not find a JavaScript runtime. See https://github.com/sstephenson/execjs for a list of available runtimes. (ExecJS::RuntimeUnavailable)
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/execjs-2.2.1/lib/execjs.rb:5:in `&lt;module:ExecJS&gt;'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/execjs-2.2.1/lib/execjs.rb:4:in `&lt;top (required)&gt;'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/uglifier-2.1.1/lib/uglifier.rb:3:in `require'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/uglifier-2.1.1/lib/uglifier.rb:3:in `&lt;top (required)&gt;'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@global/gems/bundler-1.6.2/lib/bundler/runtime.rb:76:in `require'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@global/gems/bundler-1.6.2/lib/bundler/runtime.rb:76:in `block (2 levels) in require'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@global/gems/bundler-1.6.2/lib/bundler/runtime.rb:72:in `each'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@global/gems/bundler-1.6.2/lib/bundler/runtime.rb:72:in `block in require'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@global/gems/bundler-1.6.2/lib/bundler/runtime.rb:61:in `each'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@global/gems/bundler-1.6.2/lib/bundler/runtime.rb:61:in `require'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@global/gems/bundler-1.6.2/lib/bundler.rb:132:in `require'
    from /home/hfeng/rails_projects/first_app/config/application.rb:7:in `&lt;top (required)&gt;'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/railties-4.0.8/lib/rails/commands.rb:74:in `require'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/railties-4.0.8/lib/rails/commands.rb:74:in `block in &lt;top (required)&gt;'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/railties-4.0.8/lib/rails/commands.rb:71:in `tap'
    from /home/hfeng/.rvm/gems/ruby-2.0.0-p481@railstutorial_rails_4_0/gems/railties-4.0.8/lib/rails/commands.rb:71:in `&lt;top (required)&gt;'
    from bin/rails:4:in `require'
    from bin/rails:4:in `&lt;main&gt;'
hfeng@ubuntu1204:~/rails_projects/first_app$ sudo apt-get install nodejs
[sudo] password for hfeng:
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
  libc-ares2 libev4 libicu48 libv8-3.7.12.22
The following NEW packages will be installed:
  libc-ares2 libev4 libicu48 libv8-3.7.12.22 nodejs
0 upgraded, 5 newly installed, 0 to remove and 56 not upgraded.
Need to get 10.2 MB of archives.
After this operation, 28.6 MB of additional disk space will be used.
Do you want to continue [Y/n]? y
Get:1 http://us.archive.ubuntu.com/ubuntu/ precise/main libc-ares2 amd64 1.7.5-1 [36.6 kB]
Get:2 http://us.archive.ubuntu.com/ubuntu/ precise-updates/main libicu48 amd64 4.8.1.1-3ubuntu0.1 [8105 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu/ precise/universe libv8-3.7.12.22 amd64 3.7.12.22-3 [1369 kB]
Get:4 http://us.archive.ubuntu.com/ubuntu/ precise/universe libev4 amd64 1:4.11-1 [29.0 kB]
Get:5 http://us.archive.ubuntu.com/ubuntu/ precise/universe nodejs amd64 0.6.12~dfsg1-1ubuntu1 [664 kB]
Fetched 10.2 MB in 1min 26s (119 kB/s)
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Selecting previously unselected package libc-ares2.
(Reading database ... 57743 files and directories currently installed.)
Unpacking libc-ares2 (from .../libc-ares2_1.7.5-1_amd64.deb) ...
Selecting previously unselected package libicu48.
Unpacking libicu48 (from .../libicu48_4.8.1.1-3ubuntu0.1_amd64.deb) ...
Selecting previously unselected package libv8-3.7.12.22.
Unpacking libv8-3.7.12.22 (from .../libv8-3.7.12.22_3.7.12.22-3_amd64.deb) ...
Selecting previously unselected package libev4.
Unpacking libev4 (from .../libev4_1%3a4.11-1_amd64.deb) ...
Selecting previously unselected package nodejs.
Unpacking nodejs (from .../nodejs_0.6.12~dfsg1-1ubuntu1_amd64.deb) ...
Processing triggers for man-db ...
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Setting up libc-ares2 (1.7.5-1) ...
Setting up libicu48 (4.8.1.1-3ubuntu0.1) ...
Setting up libv8-3.7.12.22 (3.7.12.22-3) ...
Setting up libev4 (1:4.11-1) ...
Setting up nodejs (0.6.12~dfsg1-1ubuntu1) ...
update-alternatives: using /usr/bin/node to provide /usr/bin/js (js) in auto mode.
Processing triggers for libc-bin ...
ldconfig deferred processing now taking place
hfeng@ubuntu1204:~/rails_projects/first_app$ rails server
=&gt; Booting WEBrick
=&gt; Rails 4.0.8 application starting in development on http://0.0.0.0:3000
=&gt; Run `rails server -h` for more startup options
=&gt; Ctrl-C to shutdown server
[2014-07-06 02:32:27] INFO  WEBrick 1.3.1
[2014-07-06 02:32:27] INFO  ruby 2.0.0 (2014-05-08) [x86_64-linux]
[2014-07-06 02:32:27] INFO  WEBrick::HTTPServer#start: pid=19734 port=3000
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-6" class="outline-4">
<h4 id="sec-1-2-6">Model-view-controller (MVC)</h4>
<div class="outline-text-4" id="text-1-2-6">
<ul class="org-ul">
<li>rails是一个完全的mvc框架:
<ol class="org-ol">
<li>浏览器发送一个requst给web server(不一定是rails server, rails server只是
测试和开发时候用到的, 真正部署的时候可能会使用其他的server)
</li>
<li>web server收到request以后,转给Rails controller
</li>
<li>少部分情况下Rails controller会直接返回一个HTML(view) 页面给浏览器
</li>
<li>多数情况下,Rails controller会和model交流,互通有无. 在rails里面, model就
是Ruby对象,负责存储数据(会利用数据库进行存储). 在和model交互完数据后,把
得到的数据转换成html返回给浏览器.
</li>
</ol>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Version control with Git</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>从略.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">Deploying</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>使用heroku来进行部署, heroku使用的是postgre数据库,所以要对Gem进行如下修改:
增加pg相关的gem
<div class="org-src-container">

<pre class="src src-diff"> # Use debugger
 # gem 'debugger', group: [:development, :test]
+
+group :production do
+  gem 'pg', '0.15.1'
+  gem 'rails_12factor', '0.0.2'
+end
</pre>
</div>
</li>
<li>然后我们要调用bundle install (不使用bundle update的原因是,我们没有更新版本,
只是更新了pg, 贸然的使用bundle update,很可能会引入一些新的版本,导致应用崩溃)
这次还使用了&#x2013;with production, 其作用"不要"安装任何production的gem,在这个
例子里面就是pg和rails_12factor
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/first_app$ bundle install --without production
Fetching source index from https://rubygems.org/
Resolving dependencies.........................
Using rake 10.3.2
Using i18n 0.6.11
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using bundler 1.6.2
Using coffee-script-source 1.7.1
Using execjs 2.2.1
Using coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Using coffee-rails 4.0.1
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using tilt 1.4.1
Using sprockets 2.12.1
Using sprockets-rails 2.0.1
Using rails 4.0.8
Using rdoc 3.12.2
Using sass 3.3.10
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using sqlite3 1.3.8
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
</pre>
</div>
</li>
<li>虽然我们没有更改gem版本,但是我们增加了production的内容,所以Gemfile.lock还是
会改变,我们要把这个改变加入到版本管理系统里面.
<div class="org-src-container">

<pre class="src src-diff">--- a/Gemfile.lock
+++ b/Gemfile.lock
@@ -50,6 +50,7 @@ GEM
     mime-types (1.25.1)
     minitest (4.7.5)
     multi_json (1.10.1)
+    pg (0.15.1)
     polyglot (0.3.5)
     rack (1.5.2)
     rack-test (0.6.2)
@@ -62,6 +63,11 @@ GEM
       bundler (&gt;= 1.3.0, &lt; 2.0)
       railties (= 4.0.8)
       sprockets-rails (~&gt; 2.0)
+    rails_12factor (0.0.2)
+      rails_serve_static_assets
+      rails_stdout_logging
+    rails_serve_static_assets (0.0.2)
+    rails_stdout_logging (0.0.3)
     railties (4.0.8)
       actionpack (= 4.0.8)
       activesupport (= 4.0.8)
@@ -108,7 +114,9 @@ DEPENDENCIES
   coffee-rails (= 4.0.1)
   jbuilder (= 1.0.2)
   jquery-rails (= 3.0.4)
+  pg (= 0.15.1)
   rails (= 4.0.8)
+  rails_12factor (= 0.0.2)
   sass-rails (= 4.0.1)
   sdoc (= 0.3.20)
   sqlite3 (= 1.3.8)
</pre>
</div>
</li>
<li>然后是要安装heroku公司的cli工具, ubuntu上的安装过程如下
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/first_app$ wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh
This script requires superuser access to install apt packages.
You will be prompted for your password by sudo.
[sudo] password for hfeng:
--2014-07-06 03:26:49--  https://toolbelt.heroku.com/apt/release.key
Resolving toolbelt.heroku.com (toolbelt.heroku.com)... 23.23.227.87, 107.22.186.187, 50.19.233.212
Connecting to toolbelt.heroku.com (toolbelt.heroku.com)|23.23.227.87|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1737 (1.7K) [application/octet-stream]
Saving to: `STDOUT'

100%[======================================&gt;] 1,737       --.-K/s   in 0.002s

2014-07-06 03:26:51 (858 KB/s) - written to stdout [1737/1737]

OK
Hit http://us.archive.ubuntu.com precise Release.gpg
Get:1 http://us.archive.ubuntu.com precise-updates Release.gpg [198 B]
Hit http://us.archive.ubuntu.com precise-backports Release.gpg
Get:2 http://security.ubuntu.com precise-security Release.gpg [198 B]
Hit http://us.archive.ubuntu.com precise Release
Get:3 http://us.archive.ubuntu.com precise-updates Release [49.6 kB]
Get:4 http://security.ubuntu.com precise-security Release [49.6 kB]
Hit http://us.archive.ubuntu.com precise-backports Release
Get:5 http://toolbelt.heroku.com ./ Release.gpg [490 B]
Hit http://us.archive.ubuntu.com precise/main Sources
Hit http://us.archive.ubuntu.com precise/restricted Sources
Hit http://us.archive.ubuntu.com precise/universe Sources
Hit http://us.archive.ubuntu.com precise/multiverse Sources
Hit http://us.archive.ubuntu.com precise/main amd64 Packages
Hit http://us.archive.ubuntu.com precise/restricted amd64 Packages
Hit http://us.archive.ubuntu.com precise/universe amd64 Packages
Hit http://us.archive.ubuntu.com precise/multiverse amd64 Packages
Hit http://us.archive.ubuntu.com precise/main i386 Packages
Hit http://us.archive.ubuntu.com precise/restricted i386 Packages
Get:6 http://security.ubuntu.com precise-security/main Sources [106 kB]
Hit http://us.archive.ubuntu.com precise/universe i386 Packages
Hit http://us.archive.ubuntu.com precise/multiverse i386 Packages
Hit http://us.archive.ubuntu.com precise/main TranslationIndex
Hit http://us.archive.ubuntu.com precise/multiverse TranslationIndex
Hit http://us.archive.ubuntu.com precise/restricted TranslationIndex
Hit http://us.archive.ubuntu.com precise/universe TranslationIndex
Get:7 http://us.archive.ubuntu.com precise-updates/main Sources [475 kB]
Get:8 http://security.ubuntu.com precise-security/restricted Sources [2494 B]
Get:9 http://security.ubuntu.com precise-security/universe Sources [30.7 kB]
Get:10 http://toolbelt.heroku.com ./ Release [1609 B]
Get:11 http://security.ubuntu.com precise-security/multiverse Sources [1795 B]
Get:12 http://security.ubuntu.com precise-security/main amd64 Packages [412 kB]
Get:13 http://us.archive.ubuntu.com precise-updates/restricted Sources [8056 B]
Get:14 http://us.archive.ubuntu.com precise-updates/universe Sources [108 kB]
Get:15 http://toolbelt.heroku.com ./ Packages [1064 B]
Get:16 http://us.archive.ubuntu.com precise-updates/multiverse Sources [8905 B]
Get:17 http://security.ubuntu.com precise-security/restricted amd64 Packages [4627 B]
Get:18 http://us.archive.ubuntu.com precise-updates/main amd64 Packages [821 kB]
Get:19 http://security.ubuntu.com precise-security/universe amd64 Packages [94.1 kB]
Get:20 http://security.ubuntu.com precise-security/multiverse amd64 Packages [2442 B]
Get:21 http://security.ubuntu.com precise-security/main i386 Packages [440 kB]
Get:22 http://security.ubuntu.com precise-security/restricted i386 Packages [4620 B]
Get:23 http://security.ubuntu.com precise-security/universe i386 Packages [99.7 kB]
Get:24 http://security.ubuntu.com precise-security/multiverse i386 Packages [2650 B]
Hit http://security.ubuntu.com precise-security/main TranslationIndex
Hit http://security.ubuntu.com precise-security/multiverse TranslationIndex
Hit http://security.ubuntu.com precise-security/restricted TranslationIndex
Hit http://security.ubuntu.com precise-security/universe TranslationIndex
Get:25 http://us.archive.ubuntu.com precise-updates/restricted amd64 Packages [13.7 kB]
Get:26 http://us.archive.ubuntu.com precise-updates/universe amd64 Packages [244 kB]
Hit http://security.ubuntu.com precise-security/main Translation-en
Hit http://security.ubuntu.com precise-security/multiverse Translation-en
Hit http://security.ubuntu.com precise-security/restricted Translation-en
Get:27 http://us.archive.ubuntu.com precise-updates/multiverse amd64 Packages [15.3 kB]
Get:28 http://us.archive.ubuntu.com precise-updates/main i386 Packages [853 kB]
Hit http://security.ubuntu.com precise-security/universe Translation-en
Get:29 http://us.archive.ubuntu.com precise-updates/restricted i386 Packages [13.7 kB]
Get:30 http://us.archive.ubuntu.com precise-updates/universe i386 Packages [251 kB]
Get:31 http://us.archive.ubuntu.com precise-updates/multiverse i386 Packages [15.5 kB]
Hit http://us.archive.ubuntu.com precise-updates/main TranslationIndex
Hit http://us.archive.ubuntu.com precise-updates/multiverse TranslationIndex
Hit http://us.archive.ubuntu.com precise-updates/restricted TranslationIndex
Hit http://us.archive.ubuntu.com precise-updates/universe TranslationIndex
Hit http://us.archive.ubuntu.com precise-backports/main Sources
Hit http://us.archive.ubuntu.com precise-backports/restricted Sources
Hit http://us.archive.ubuntu.com precise-backports/universe Sources
Hit http://us.archive.ubuntu.com precise-backports/multiverse Sources
Hit http://us.archive.ubuntu.com precise-backports/main amd64 Packages
Hit http://us.archive.ubuntu.com precise-backports/restricted amd64 Packages
Hit http://us.archive.ubuntu.com precise-backports/universe amd64 Packages
Hit http://us.archive.ubuntu.com precise-backports/multiverse amd64 Packages
Hit http://us.archive.ubuntu.com precise-backports/main i386 Packages
Hit http://us.archive.ubuntu.com precise-backports/restricted i386 Packages
Hit http://us.archive.ubuntu.com precise-backports/universe i386 Packages
Hit http://us.archive.ubuntu.com precise-backports/multiverse i386 Packages
Hit http://us.archive.ubuntu.com precise-backports/main TranslationIndex
Hit http://us.archive.ubuntu.com precise-backports/multiverse TranslationIndex
Hit http://us.archive.ubuntu.com precise-backports/restricted TranslationIndex
Hit http://us.archive.ubuntu.com precise-backports/universe TranslationIndex
Hit http://us.archive.ubuntu.com precise/main Translation-en
Hit http://us.archive.ubuntu.com precise/multiverse Translation-en
Hit http://us.archive.ubuntu.com precise/restricted Translation-en
Hit http://us.archive.ubuntu.com precise/universe Translation-en
Hit http://us.archive.ubuntu.com precise-updates/main Translation-en
Hit http://us.archive.ubuntu.com precise-updates/multiverse Translation-en
Hit http://us.archive.ubuntu.com precise-updates/restricted Translation-en
Hit http://us.archive.ubuntu.com precise-updates/universe Translation-en
Hit http://us.archive.ubuntu.com precise-backports/main Translation-en
Hit http://us.archive.ubuntu.com precise-backports/multiverse Translation-en
Hit http://us.archive.ubuntu.com precise-backports/restricted Translation-en
Hit http://us.archive.ubuntu.com precise-backports/universe Translation-en
Ign http://toolbelt.heroku.com ./ Translation-en
Fetched 4131 kB in 17s (238 kB/s)
Reading package lists... Done
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
  foreman heroku libruby1.9.1 ruby1.9.1
Suggested packages:
  ruby1.9.1-examples ri1.9.1 graphviz ruby1.9.1-dev
The following NEW packages will be installed:
  foreman heroku heroku-toolbelt libruby1.9.1 ruby1.9.1
0 upgraded, 5 newly installed, 0 to remove and 56 not upgraded.
Need to get 4971 kB of archives.
After this operation, 12.6 MB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu/ precise-updates/main libruby1.9.1 amd64 1.9.3.0-1ubuntu2.8 [4104 kB]
Get:2 http://toolbelt.heroku.com/ubuntu/ ./ foreman 0.74.0 [113 kB]
Get:3 http://toolbelt.heroku.com/ubuntu/ ./ heroku 3.9.1 [716 kB]
Get:4 http://toolbelt.heroku.com/ubuntu/ ./ heroku-toolbelt 3.9.1 [614 B]
Get:5 http://us.archive.ubuntu.com/ubuntu/ precise-updates/main ruby1.9.1 amd64 1.9.3.0-1ubuntu2.8 [37.1 kB]
Fetched 4971 kB in 28s (174 kB/s)
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Selecting previously unselected package libruby1.9.1.
(Reading database ... 57830 files and directories currently installed.)
Unpacking libruby1.9.1 (from .../libruby1.9.1_1.9.3.0-1ubuntu2.8_amd64.deb) ...
Selecting previously unselected package ruby1.9.1.
Unpacking ruby1.9.1 (from .../ruby1.9.1_1.9.3.0-1ubuntu2.8_amd64.deb) ...
Selecting previously unselected package foreman.
Unpacking foreman (from .../foreman_0.74.0_all.deb) ...
Selecting previously unselected package heroku.
Unpacking heroku (from .../archives/heroku_3.9.1_all.deb) ...
Selecting previously unselected package heroku-toolbelt.
Unpacking heroku-toolbelt (from .../heroku-toolbelt_3.9.1_all.deb) ...
Processing triggers for man-db ...
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Setting up libruby1.9.1 (1.9.3.0-1ubuntu2.8) ...
Setting up ruby1.9.1 (1.9.3.0-1ubuntu2.8) ...
update-alternatives: using /usr/bin/gem1.9.1 to provide /usr/bin/gem (gem) in auto mode.
update-alternatives: using /usr/bin/ruby1.9.1 to provide /usr/bin/ruby (ruby) in auto mode.
Setting up foreman (0.74.0) ...
Setting up heroku (3.9.1) ...
Setting up heroku-toolbelt (3.9.1) ...
Processing triggers for libc-bin ...
ldconfig deferred processing now taking place
hfeng@ubuntu1204:~/rails_projects/first_app$ which heroku
/usr/bin/heroku
hfeng@ubuntu1204:~/rails_projects/first_app$ heroku --version
heroku-toolbelt/3.9.1 (x86_64-linux) ruby/1.9.3
</pre>
</div>
</li>
<li>然后就可以部署啦!
<ul class="org-ul">
<li>首先,要登录
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/first_app$ heroku login
Enter your Heroku credentials.
Email: harrifeng@gmail.com
Password (typing will be hidden):

Authentication successful.
</pre>
</div>
</li>
<li>其次,是部署
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/first_app$ pwd
pwd
/home/hfeng/rails_projects/first_app
hfeng@ubuntu1204:~/rails_projects/first_app$ git branch
git branch
  heroku
* master
hfeng@ubuntu1204:~/rails_projects/first_app$ heroku create
heroku create
Creating peaceful-falls-3143... done, stack is cedar
http://peaceful-falls-3143.herokuapp.com/ | git@heroku.com:peaceful-falls-3143.git
Git remote heroku added
hfeng@ubuntu1204:~/rails_projects/first_app$ git remote -v
git remote -v
heroku  git@heroku.com:peaceful-falls-3143.git (fetch)
heroku  git@heroku.com:peaceful-falls-3143.git (push)
hfeng@ubuntu1204:~/rails_projects/first_app$ git push heroku master
git push heroku master
Warning: Permanently added the RSA host key for IP address '50.19.85.132' to the list of known hosts.
Initializing repository, done.
Counting objects: 72, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (61/61), done.
Writing objects: 100% (72/72), 15.69 KiB, done.
Total 72 (delta 10), reused 0 (delta 0)

-----&gt; Ruby app detected
-----&gt; Compiling Ruby/Rails
-----&gt; Using Ruby version: ruby-2.0.0
-----&gt; Installing dependencies using 1.6.3
       Running: bundle install --without development:test --path vendor/bundle --binstubs vendor/bundle/bin -j4 --deployment
       Fetching gem metadata from https://rubygems.org/..........
       Fetching additional metadata from https://rubygems.org/..
       Installing minitest 4.7.5
       Installing i18n 0.6.11
       Installing multi_json 1.10.1
       Installing rake 10.3.2
       Installing thread_safe 0.3.4
       Installing builder 3.1.4
       Installing erubis 2.7.0
       Installing rack 1.5.2
       Installing tzinfo 0.3.40
       Installing mime-types 1.25.1
       Installing activerecord-deprecated_finders 1.0.3
       Installing polyglot 0.3.5
       Installing execjs 2.2.1
       Installing arel 4.0.2
       Installing coffee-script-source 1.7.1
       Installing thor 0.19.1
       Installing hike 1.2.3
       Using bundler 1.6.3
       Installing tilt 1.4.1
       Installing rails_serve_static_assets 0.0.2
       Installing rails_stdout_logging 0.0.3
       Installing json 1.8.1
       Installing rack-test 0.6.2
       Installing activesupport 4.0.8
       Installing sass 3.3.10
       Installing uglifier 2.1.1
       Installing treetop 1.4.15
       Installing coffee-script 2.3.0
       Installing rails_12factor 0.0.2
       Installing sprockets 2.12.1
       Installing rdoc 3.12.2
       Installing actionpack 4.0.8
       Installing jbuilder 1.0.2
       Installing activemodel 4.0.8
       Installing sdoc 0.3.20
       Installing mail 2.5.4
       Installing railties 4.0.8
       Installing sprockets-rails 2.0.1
       Installing actionmailer 4.0.8
       Installing coffee-rails 4.0.1
       Installing activerecord 4.0.8
       Installing jquery-rails 3.0.4
       Installing sass-rails 4.0.1
       Installing turbolinks 1.1.1
       Installing pg 0.15.1
       Installing rails 4.0.8
       Your bundle is complete!
       Gems in the groups development and test were not installed.
       It was installed into ./vendor/bundle
       Post-install message from rdoc:
       Depending on your version of ruby, you may need to install ruby rdoc/ri data:
       &lt;= 1.8.6 : unsupported
       = 1.8.7 : gem install rdoc-data; rdoc-data --install
       = 1.9.1 : gem install rdoc-data; rdoc-data --install
       &gt;= 1.9.2 : nothing to do! Yay!
       Bundle completed (23.17s)
       Cleaning up the bundler cache.
-----&gt; Writing config/database.yml to read from DATABASE_URL
-----&gt; Preparing app for Rails asset pipeline
       Running: rake assets:precompile
       I, [2014-07-19T10:17:28.533402 #1061]  INFO -- : Writing /tmp/build_d9f77b59-def0-4971-a5fc-146f03a6350b/public/assets/application-ca8bf38828b1ee4126682823eb3fa49c.js
       I, [2014-07-19T10:17:28.556921 #1061]  INFO -- : Writing /tmp/build_d9f77b59-def0-4971-a5fc-146f03a6350b/public/assets/application-98f28c7358913ad23ff595d3f8287e32.css
       Asset precompilation completed (6.56s)
       Cleaning assets
       Running: rake assets:clean
-----&gt; WARNINGS:
       No Procfile detected, using the default web server (webrick)
       https://devcenter.heroku.com/articles/ruby-default-web-server
-----&gt; Discovering process types
       Procfile declares types -&gt; (none)
       Default types for Ruby  -&gt; console, rake, web, worker

-----&gt; Compressing... done, 21.1MB
-----&gt; Launching... done, v6
       http://peaceful-falls-3143.herokuapp.com/ deployed to Heroku

To git@heroku.com:peaceful-falls-3143.git
 * [new branch]      master -&gt; master
</pre>
</div>
</li>
<li>再次,打开浏览器,输入<a href="http://peaceful-falls-3143.herokuapp.com">http://peaceful-falls-3143.herokuapp.com</a> 会发现&#x2026;.还
是不对!但是这个状况是必定发生的,在我们config好root route之后,就不会再发生了.
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1">Heroku commands</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li>使用heroku cli改下名字,容易记忆一点
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/first_app$ heroku rename hfeng-railstutorial
heroku rename hfeng-railstutorial
Renaming peaceful-falls-3143 to hfeng-railstutorial... done
http://hfeng-railstutorial.herokuapp.com/ | git@heroku.com:hfeng-railstutorial.git
Git remote heroku updated
hfeng@ubuntu1204:~/rails_projects/first_app$ git remote -v
git remote -v
heroku  git@heroku.com:hfeng-railstutorial.git (fetch)
heroku  git@heroku.com:hfeng-railstutorial.git (push)
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Chapter 02: A demo app</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Planning the application</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>和上一次的Gemfile一样准备一个Gemfile,然后bundle update之后bundle install
&#x2013;without production
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/demo_app$ bundle update
Fetching gem metadata from https://rubygems.org/..........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.11
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using bundler 1.6.2
Using coffee-script-source 1.7.1
Using execjs 2.2.1
Using coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Using coffee-rails 4.0.1
Using hike 1.2.3
Using jbuilder 1.0.2 (was 1.5.3)
Using jquery-rails 3.0.4 (was 3.1.1)
Using json 1.8.1
Using tilt 1.4.1
Using sprockets 2.12.1 (was 2.11.0)
Using sprockets-rails 2.0.1 (was 2.1.3)
Using rails 4.0.8
Using rdoc 3.12.2 (was 4.1.1)
Using sass 3.3.10 (was 3.2.19)
Using sass-rails 4.0.1 (was 4.0.3)
Using sdoc 0.3.20 (was 0.4.0)
Using sqlite3 1.3.8 (was 1.3.9)
Using turbolinks 1.1.1 (was 2.2.2)
Using uglifier 2.1.1 (was 2.5.3)
Your bundle is updated!
Gems in the group production were not installed.
hfeng@ubuntu1204:~/rails_projects/demo_app$ bundle install --without production
Using rake 10.3.2
Using i18n 0.6.11
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using coffee-script-source 1.7.1
Using execjs 2.2.1
Using coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Using coffee-rails 4.0.1
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using bundler 1.6.2
Using tilt 1.4.1
Using sprockets 2.12.1
Using sprockets-rails 2.0.1
Using rails 4.0.8
Using rdoc 3.12.2
Using sass 3.3.10
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using sqlite3 1.3.8
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">Modeling demo users</h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>我们先来创建一个用户的model,其只有三个域名:
<ul class="org-ul">
<li>integer类型的id
</li>
<li>string类型的name
</li>
<li>string类型的email
</li>
</ul>
</li>
<li>后面我们会看到,我们创建了一个user的ruby类,同时会有同名的数据库user创建,里面
有email, name, id三个column
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2">Modeling demo microposts</h4>
<div class="outline-text-4" id="text-2-1-2">
<ul class="org-ul">
<li>micropost就类型twitter的一个状态,也有三个域:
<ul class="org-ul">
<li>integer类型的id
</li>
<li>string类型的content(因为不能超过140个字么)
</li>
<li>integer类型的user_id,其实就是外键
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">The Users resource</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>rails可以为我们一次性创建一个resource(在这里就是User resource),为这个resource
提供了HTTP协议的"增删改查"的请求支持
</li>
<li>提供的方法是rails generate scaffold 命令. 后面跟的都是"单数"
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/demo_app$ rails generate scaffold User name:string email:string
      invoke  active_record
      create    db/migrate/20140705200918_create_users.rb
      create    app/models/user.rb
      invoke    test_unit
      create      test/models/user_test.rb
      create      test/fixtures/users.yml
      invoke  resource_route
       route    resources :users
      invoke  jbuilder_scaffold_controller
      create    app/controllers/users_controller.rb
      invoke    erb
      create      app/views/users
      create      app/views/users/index.html.erb
      create      app/views/users/edit.html.erb
      create      app/views/users/show.html.erb
      create      app/views/users/new.html.erb
      create      app/views/users/_form.html.erb
      invoke    test_unit
      create      test/controllers/users_controller_test.rb
      invoke    helper
      create      app/helpers/users_helper.rb
      invoke      test_unit
      create        test/helpers/users_helper_test.rb
      invoke    jbuilder
       exist      app/views/users
      create      app/views/users/index.json.jbuilder
      create      app/views/users/show.json.jbuilder
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/users.js.coffee
      invoke    scss
      create      app/assets/stylesheets/users.css.scss
      invoke  scss
      create    app/assets/stylesheets/scaffolds.css.scss
</pre>
</div>
</li>
<li>为了能让我们的改变体现在网站上,需要migrate数据库,使用的手段是rake
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/demo_app$ rake db:migrate
== 20140705200918 CreateUsers: migrating ======================================
-- create_table(:users)
   -&gt; 0.0009s
== 20140705200918 CreateUsers: migrated (0.0010s) =============================
</pre>
</div>
</li>
<li>这是我们第一次使用rake,其实rake的使用在rails里面非常广泛,我们可以使用rake -T
来查看可用命令(加db就是可用rake 数据库命令)
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/demo_app$ rake -T
rake about                              # List versions of all Rails framew...
rake assets:clean[keep]                 # Remove old compiled assets
rake assets:clobber                     # Remove compiled assets
rake assets:environment                 # Load asset compile environment
rake assets:precompile                  # Compile all the assets named in c...
rake cache_digests:dependencies         # Lookup first-level dependencies f...
rake cache_digests:nested_dependencies  # Lookup nested dependencies for TE...
rake db:create                          # Create the database from DATABASE...
rake db:drop                            # Drops the database using DATABASE...
rake db:fixtures:load                   # Load fixtures into the current en...
rake db:migrate                         # Migrate the database (options: VE...
rake db:migrate:status                  # Display status of migrations
rake db:rollback                        # Rolls the schema back to the prev...
rake db:schema:cache:clear              # Clear a db/schema_cache.dump file
rake db:schema:cache:dump               # Create a db/schema_cache.dump file
rake db:schema:dump                     # Create a db/schema.rb file that c...
rake db:schema:load                     # Load a schema.rb file into the da...
rake db:seed                            # Load the seed data from db/seeds.rb
rake db:setup                           # Create the database, load the sch...
rake db:structure:dump                  # Dump the database structure to db...
rake db:version                         # Retrieves the current schema vers...
rake doc:app                            # Generate docs for the app -- also...
rake log:clear                          # Truncates all *.log files in log/...
rake middleware                         # Prints out your Rack middleware s...
rake notes                              # Enumerate all annotations (use no...
rake notes:custom                       # Enumerate a custom annotation, sp...
rake rails:template                     # Applies the template supplied by ...
rake rails:update                       # Update configs and some other ini...
rake routes                             # Print out all defined routes in m...
rake secret                             # Generate a cryptographically secu...
rake stats                              # Report code statistics (KLOCs, et...
rake test                               # Runs test:units, test:functionals...
rake test:all                           # Run tests quickly by merging all ...
rake test:all:db                        # Run tests quickly, but also reset db
rake test:recent                        # Run tests for {:recent=&gt;["test:de...
rake test:uncommitted                   # Run tests for {:uncommitted=&gt;["te...
rake time:zones:all                     # Displays all time zones, also ava...
rake tmp:clear                          # Clear session, cache, and socket ...
rake tmp:create                         # Creates tmp directories for sessi...
hfeng@ubuntu1204:~/rails_projects/demo_app$ rake -T db
rake db:create              # Create the database from DATABASE_URL or conf...
rake db:drop                # Drops the database using DATABASE_URL or the ...
rake db:fixtures:load       # Load fixtures into the current environment's ...
rake db:migrate             # Migrate the database (options: VERSION=x, VER...
rake db:migrate:status      # Display status of migrations
rake db:rollback            # Rolls the schema back to the previous version...
rake db:schema:cache:clear  # Clear a db/schema_cache.dump file
rake db:schema:cache:dump   # Create a db/schema_cache.dump file
rake db:schema:dump         # Create a db/schema.rb file that can be portab...
rake db:schema:load         # Load a schema.rb file into the database
rake db:seed                # Load the seed data from db/seeds.rb
rake db:setup               # Create the database, load the schema, and ini...
rake db:structure:dump      # Dump the database structure to db/structure.sql
rake db:version             # Retrieves the current schema version number
rake test:all:db            # Run tests quickly, but also reset db
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1">A user tour</h4>
<div class="outline-text-4" id="text-2-2-1">
<ul class="org-ul">
<li>我们下面来看看新建的数据模型都有神马内容
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">URL</th>
<th scope="col" class="left">Action</th>
<th scope="col" class="left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">/users</td>
<td class="left">index</td>
<td class="left">page to list all users</td>
</tr>

<tr>
<td class="left">/users/1</td>
<td class="left">show</td>
<td class="left">page to show user with id 1</td>
</tr>

<tr>
<td class="left">/users/new</td>
<td class="left">new</td>
<td class="left">page to make a new user</td>
</tr>

<tr>
<td class="left">/users/1/edit</td>
<td class="left">edit</td>
<td class="left">page to edit user with id 1</td>
</tr>
</tbody>
</table>
</li>
<li>index是列出所有用户
<img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/url_index.png" alt="url_index.png" />
</li>
<li>添加一个用户后会显示第一个用户的信息, 就是show
<img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/url_show.png" alt="url_show.png" />
</li>
<li>增加一个用户是new
<img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/url_new.png" alt="url_new.png" />
</li>
<li>编辑一个用户是edit
<img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/url_edit.png" alt="url_edit.png" />
</li>
<li>然后再删除一个, url和show的时候一样,但是如果你知道HTTP协议的话,你会知道其实是method不同
<img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/url_delete.png" alt="url_delete.png" />
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2">MVC in action</h4>
<div class="outline-text-4" id="text-2-2-2">
<ul class="org-ul">
<li>下图就是一个URL(/users)如何从浏览器发送,最后又回到浏览器:

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/mvc_rails.png" alt="mvc_rails.png" />
</p>
<p><span class="figure-number">Figure 1:</span> mvc-rails.png</p>
</div>
</li>
<li>上面的Rails router负责将/users的解析,在rails里面的对应配置文件是config/routes.rb
<div class="org-src-container">

<pre class="src src-ruby"># config/routes.rb
DemoApp::Applicatin.routes.draw do
  resources :users
  # ...
end
</pre>
</div>
</li>
<li>为user resource服务的controller在这个例子里面是users_controllers.rb, 其是
一个继承于ApplicationController的ruby class
<div class="org-src-container">

<pre class="src src-ruby"># app/controllers/users_controller.rb
class UsersController &lt; ApplicationController
  # ...

  def index
    # ...
  end

  def show
    # ...
  end

  def new
    # ...
  end

  def create
    # ...
  end

  def edit
    # ...
  end

  def update
    # ...
  end

  def destroy
    # ...
  end
end
</pre>
</div>
</li>
<li>其实上面的函数,其实都是HTTP里面的request method, 我们来看看对应表
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">HTTP request</th>
<th scope="col" class="left">URL</th>
<th scope="col" class="left">Action</th>
<th scope="col" class="left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">GET</td>
<td class="left">/users</td>
<td class="left">index</td>
<td class="left">page to list all users</td>
</tr>

<tr>
<td class="left">GET</td>
<td class="left">/users/1</td>
<td class="left">show</td>
<td class="left">page to show user with id 1</td>
</tr>

<tr>
<td class="left">GET</td>
<td class="left">/users/new</td>
<td class="left">new</td>
<td class="left">page to make a new user</td>
</tr>

<tr>
<td class="left">POST</td>
<td class="left">/users</td>
<td class="left">create</td>
<td class="left">create a new user</td>
</tr>

<tr>
<td class="left">GET</td>
<td class="left">/uesers/1/edi</td>
<td class="left">edit</td>
<td class="left">page to edit suer with id 1</td>
</tr>

<tr>
<td class="left">PATCH</td>
<td class="left">/users/1</td>
<td class="left">update</td>
<td class="left">update user with id 1</td>
</tr>

<tr>
<td class="left">DELETE</td>
<td class="left">/users/1</td>
<td class="left">destroy</td>
<td class="left">delete user with id 1</td>
</tr>
</tbody>
</table>
</li>
<li>下面我们以index函数来介绍一下是如何将MVC三部分串联起来的:
<ul class="org-ul">
<li>首先看C: index定义在users_controller.rb里面. 其主要内容就是定义了一个instance
variable @users, 然后把User(是M的一个部分)的所有的内容都传递给@users
<div class="org-src-container">

<pre class="src src-ruby"># app/controllers/users_controller.rb

class UsersController &lt; ApplicationController
  # ...
  def index
    @users = User.all
  end
end
</pre>
</div>
</li>
<li>其次看M,也就是上面的大写的User, 其定义的位置是在app/models/user.rb里面,
虽然看起来没什么内容,但是它主要的函数都是从ActiveRecord::Base里面继承了,
比如函数all
<div class="org-src-container">

<pre class="src src-ruby"># app/models/user.rb

class User &lt; ActiveRecord::Base
end
</pre>
</div>
</li>
<li>最后我们来看看V, 上面C里面成功的初始化的函数@users会被传递到app/views/users/index.html.erb
<div class="org-src-container">

<pre class="src src-web"># app/view/users/index.html.erb

&lt;h1&gt;Listing users&lt;/h1&gt;

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Name&lt;/th&gt;
    &lt;th&gt;Email&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
  &lt;/tr&gt;

&lt;% @users.each do |user| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= user.name %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= user.email %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to 'Show', user %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to 'Edit', edit_user_path(user) %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to 'Destroy', user, method: :delete,
                                     data: { confirm: 'Are you sure?' } %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
&lt;/table&gt;

&lt;br /&gt;

&lt;%= link_to 'New User', new_user_path %&gt;
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3">Weaknesses of this Users resource</h4>
<div class="outline-text-4" id="text-2-2-3">
<ul class="org-ul">
<li>虽然看起来scaffold运行的情况不错,但是这种方式还是有很多的缺点:
<ul class="org-ul">
<li>No data validations
</li>
<li>No authentication
</li>
<li>No tests
</li>
<li>No layout
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">The Microposts resource</h3>
<div class="outline-text-3" id="text-2-3">
</div><div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1">A micropost microtour</h4>
<div class="outline-text-4" id="text-2-3-1">
<ul class="org-ul">
<li>下面我们来创建另外一个resource, micropost. 注意在命令行里面Micropost要单数,大写
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:demo_app hfeng$ rails generate scaffold Micropost content:string user_id:integer
      invoke  active_record
      create    db/migrate/20140721073734_create_microposts.rb
      create    app/models/micropost.rb
      invoke    test_unit
      create      test/models/micropost_test.rb
      create      test/fixtures/microposts.yml
      invoke  resource_route
       route    resources :microposts
      invoke  jbuilder_scaffold_controller
      create    app/controllers/microposts_controller.rb
      invoke    erb
      create      app/views/microposts
      create      app/views/microposts/index.html.erb
      create      app/views/microposts/edit.html.erb
      create      app/views/microposts/show.html.erb
      create      app/views/microposts/new.html.erb
      create      app/views/microposts/_form.html.erb
      invoke    test_unit
      create      test/controllers/microposts_controller_test.rb
      invoke    helper
      create      app/helpers/microposts_helper.rb
      invoke      test_unit
      create        test/helpers/microposts_helper_test.rb
      invoke    jbuilder
       exist      app/views/microposts
      create      app/views/microposts/index.json.jbuilder
      create      app/views/microposts/show.json.jbuilder
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/microposts.js.coffee
      invoke    scss
      create      app/assets/stylesheets/microposts.css.scss
      invoke  scss
   identical    app/assets/stylesheets/scaffolds.css.scss
</pre>
</div>
</li>
<li>创建完之后,还是要导入数据库
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:demo_app hfeng$ rake db:migrate
== 20140721073734 CreateMicroposts: migrating =================================
-- create_table(:microposts)
   -&gt; 0.0078s
== 20140721073734 CreateMicroposts: migrated (0.0079s) ========================
</pre>
</div>
</li>
<li>我们和User对比,会发现routes.rb还是被更改了
<div class="org-src-container">

<pre class="src src-diff">diff --git a/config/routes.rb b/config/routes.rb
index 56c203d..d487887 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -1,4 +1,6 @@
 DemoApp::Application.routes.draw do
+  resources :microposts
+
   resources :users

   # The priority is based upon order of creation: first created -&gt; highest priority.
</pre>
</div>
</li>
<li>其他如controller和URL等等,全部都和Users一样.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2">Putting the micro in microposts</h4>
<div class="outline-text-4" id="text-2-3-2">
<ul class="org-ul">
<li>我们的micropost是stirng类型,最多不能超过140个字符.所以要加入一些"长度检查"
<div class="org-src-container">

<pre class="src src-diff">diff --git a/app/models/micropost.rb b/app/models/micropost.rb
index f333428..91a6135 100644
--- a/app/models/micropost.rb
+++ b/app/models/micropost.rb
@@ -1,2 +1,3 @@
 class Micropost &lt; ActiveRecord::Base
+  validates :content, length: { maximum: 140 }
 end
</pre>
</div>
</li>
<li>长度检查用到了一个函数validates, 其函数代码如下
<div class="org-src-container">

<pre class="src src-ruby"># File activemodel/lib/active_model/validations/validates.rb, line 100
      def validates(*attributes)
        defaults = attributes.extract_options!.dup
        validations = defaults.slice!(*_validates_default_keys)

        raise ArgumentError, "You need to supply at least one attribute" if attributes.empty?
        raise ArgumentError, "You need to supply at least one validation" if validations.empty?

        defaults[:attributes] = attributes

        validations.each do |key, options|
          next unless options
          key = "#{key.to_s.camelize}Validator"

          begin
            validator = key.include?('::') ? key.constantize : const_get(key)
          rescue NameError
            raise ArgumentError, "Unknown validator: '#{key}'"
          end

          validates_with(validator, defaults.merge(_parse_validates_options(options)))
        end
      end
</pre>
</div>
</li>
<li>我们可以通过下面的例子来理解下ruby"极简"的函数传递方法
<div class="org-src-container">

<pre class="src src-ruby">def val(*attributes)
  attributes.each_with_index do |a, i|
    puts "NO.#{i} element is #{a}, its type is #{a.class}"
  end
end

val :content, length: { maximum: 140 }

################################################################
# &lt;===================OUTPUT===================&gt;               #
# NO.0 element is content, its type is Symbol                  #
# NO.1 element is {:length=&gt;{:maximum=&gt;140}}, its type is Hash #
################################################################
</pre>
</div>
</li>
<li>从上面的例子我们可以看到:
<ul class="org-ul">
<li>attributes 其实是一个不定参数, 输入不同数目的参数最终会在函数实现里面成为一个类型为array的变量attributes
</li>
<li>:content是第attribute数组里面的第一个参数,类型为Symbol
</li>
<li>{:length=&gt;{:maximum=&gt;140}} 为attributest里面的第二个参数, 类型为Hash. 而且其value是另外一个hash. 这里
又有两个地方的简写:
<ol class="org-ol">
<li>{:key =&gt; "value"} 简写成 {key: "value}
</li>
<li>由于Hash是validate的第二个,也是最后一个参数,所以不需要加{}, 也就是说
<div class="org-src-container">

<pre class="src src-ruby"># Completed version is this
{:length=&gt;{:maximum=&gt;140}}
# want to save "=&gt;", convert to this
{ length: { maximum: 140 } }
# Last parameter, so sonvert this
length: { maximum: 140 }
</pre>
</div>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-3-3" class="outline-4">
<h4 id="sec-2-3-3">A user has_many microposts</h4>
<div class="outline-text-4" id="text-2-3-3">
<ul class="org-ul">
<li>从数据库的角度看, user和micropost是"一对多"的关系:就是一个用户可以有多个
micropost, 反之则不成立: 一个micropost只属于一个user.
</li>
<li>这种"一对多"的关系是体现在"数据"部分的,所以,我们在M部分进行修改.相关的两个
model都要修改. 相比于前面的validates函数. belongs_to和has_many显得那么的简
单
<div class="org-src-container">

<pre class="src src-diff">diff --git a/app/models/micropost.rb b/app/models/micropost.rb
index 91a6135..ea092e5 100644
--- a/app/models/micropost.rb
+++ b/app/models/micropost.rb
@@ -1,3 +1,4 @@
 class Micropost &lt; ActiveRecord::Base
+  belongs_to :user
   validates :content, length: { maximum: 140 }
 end
    Modified   app/models/user.rb
diff --git a/app/models/user.rb b/app/models/user.rb
index 4a57cf0..d41de93 100644
--- a/app/models/user.rb
+++ b/app/models/user.rb
@@ -1,2 +1,3 @@
 class User &lt; ActiveRecord::Base
+  has_many :microposts
 end
</pre>
</div>
</li>
<li>做了这些修改以后,我们可以使用rails console来查看这些更改. rails console非
常强大,涉及M的部分都可以试试
<div class="org-src-container">

<pre class="src src-sh">2.0.0-p481 :001 &gt; first_user = User.first
  User Load (0.2ms)  SELECT "users".* FROM "users" ORDER BY "users"."id" ASC LIMIT 1
 =&gt; #&lt;User id: 1, name: "haoran feng", email: "haoran.feng@sap.com", created_at: "2014-07-21 08:44:55", updated_at: "2014-07-21 08:44:55"&gt;
2.0.0-p481 :002 &gt; first_user.methods
=&gt; [:autosave_associated_records_for_microposts, .....    :microposts, ...]
2.0.0-p481 :003 &gt; first_user.microposts
  Micropost Load (1.8ms)  SELECT "microposts".* FROM "microposts" WHERE "microposts"."user_id" = ?  [["user_id", 1]]
 =&gt; #&lt;ActiveRecord::Associations::CollectionProxy [#&lt;Micropost id: 1, content: "hello world", user_id: 1, created_at: "2014-07-21 08:45:28", updated_at: "2014-07-21 08:45:28"&gt;]&gt;
2.0.0-p481 :004 &gt; exit
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-3-4" class="outline-4">
<h4 id="sec-2-3-4">Inheritance hierarchies</h4>
<div class="outline-text-4" id="text-2-3-4">
<ul class="org-ul">
<li>model和controller都是采取了继承的方法来获取大部分的功能:
<ul class="org-ul">
<li>model的继承图如下

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch2/model-inheritance.png" alt="model-inheritance.png" />
</p>
<p><span class="figure-number">Figure 2:</span> model-inheritance.png</p>
</div>
</li>
<li>controller的继承图如下

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch2/controller-inheritance.png" alt="controller-inheritance.png" />
</p>
<p><span class="figure-number">Figure 3:</span> controller-inheritance.png</p>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-3-5" class="outline-4">
<h4 id="sec-2-3-5">Deploying the demo app</h4>
<div class="outline-text-4" id="text-2-3-5">
<ul class="org-ul">
<li>还是老样子,把例子部署到heroku上去
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:demo_app hfeng$ heroku login
Enter your Heroku credentials.
Email: harrifeng@gmail.com
Password (typing will be hidden):

Authentication successful.
hfengdeMacBook-Air:demo_app hfeng$ heroku create
heroku create
Creating fast-eyrie-3133... done, stack is cedar
http://fast-eyrie-3133.herokuapp.com/ | git@heroku.com:fast-eyrie-3133.git
Git remote heroku added
hfengdeMacBook-Air:demo_app hfeng$ heroku rename hfeng-demo_app
heroku rename hfeng-demo_app
Renaming fast-eyrie-3133 to hfeng-demo_app... failed
 !    Name must start with a letter and can only contain lowercase letters, numbers, and dashes.
hfengdeMacBook-Air:demo_app hfeng$ heroku rename hfeng-demo-app
heroku rename hfeng-demo-app
Renaming fast-eyrie-3133 to hfeng-demo-app... done
http://hfeng-demo-app.herokuapp.com/ | git@heroku.com:hfeng-demo-app.git
Git remote heroku updated
hfengdeMacBook-Air:demo_app hfeng$ git remote -v
git remote -v
heroku  git@heroku.com:hfeng-demo-app.git (fetch)
heroku  git@heroku.com:hfeng-demo-app.git (push)
origin  git@github.com:harrifeng/demo_app.git (fetch)
origin  git@github.com:harrifeng/demo_app.git (push)
hfengdeMacBook-Air:demo_app hfeng$ git push heroku master
git push heroku master
Initializing repository, done.
Counting objects: 147, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (132/132), done.
Writing objects: 100% (147/147), 24.69 KiB | 0 bytes/s, done.
Total 147 (delta 31), reused 0 (delta 0)

-----&gt; Ruby app detected
-----&gt; Compiling Ruby/Rails
-----&gt; Using Ruby version: ruby-2.0.0
-----&gt; Installing dependencies using 1.6.3
       Running: bundle install --without development:test --path vendor/bundle --binstubs vendor/bundle/bin -j4 --deployment
       Fetching gem metadata from https://rubygems.org/..........
       Fetching additional metadata from https://rubygems.org/..
       Installing minitest 4.7.5
       Installing i18n 0.6.11
       Installing rake 10.3.2
       Installing thread_safe 0.3.4
       Installing multi_json 1.10.1
       Installing builder 3.1.4
       Installing tzinfo 0.3.40
       Installing erubis 2.7.0
       Installing mime-types 1.25.1
       Installing polyglot 0.3.5
       Installing activerecord-deprecated_finders 1.0.3
       Installing rack 1.5.2
       Installing coffee-script-source 1.7.1
       Installing arel 4.0.2
       Installing execjs 2.2.1
       Installing thor 0.19.1
       Installing hike 1.2.3
       Using bundler 1.6.3
       Installing tilt 1.4.1
       Installing rails_serve_static_assets 0.0.2
       Installing rails_stdout_logging 0.0.3
       Installing json 1.8.1
       Installing sass 3.3.10
       Installing activesupport 4.0.8
       Installing rack-test 0.6.2
       Installing treetop 1.4.15
       Installing coffee-script 2.3.0
       Installing uglifier 2.1.1
       Installing rails_12factor 0.0.2
       Installing sprockets 2.12.1
       Installing activemodel 4.0.8
       Installing rdoc 3.12.2
       Installing jbuilder 1.0.2
       Installing mail 2.5.4
       Installing actionpack 4.0.8
       Installing sdoc 0.3.20
       Installing activerecord 4.0.8
       Installing actionmailer 4.0.8
       Installing sprockets-rails 2.0.1
       Installing pg 0.15.1
       Installing railties 4.0.8
       Installing coffee-rails 4.0.1
       Installing jquery-rails 3.0.4
       Installing turbolinks 1.1.1
       Installing sass-rails 4.0.1
       Installing rails 4.0.8
       Your bundle is complete!
       Gems in the groups development and test were not installed.
       It was installed into ./vendor/bundle
       Post-install message from rdoc:
       Depending on your version of ruby, you may need to install ruby rdoc/ri data:
       &lt;= 1.8.6 : unsupported
       = 1.8.7 : gem install rdoc-data; rdoc-data --install
       = 1.9.1 : gem install rdoc-data; rdoc-data --install
       &gt;= 1.9.2 : nothing to do! Yay!
       Bundle completed (20.98s)
       Cleaning up the bundler cache.
-----&gt; Writing config/database.yml to read from DATABASE_URL
-----&gt; Preparing app for Rails asset pipeline
       Running: rake assets:precompile
       I, [2014-07-21T09:36:55.949609 #1017]  INFO -- : Writing /tmp/build_b8be5592-5246-464e-ba6a-1c052a86b661/public/assets/application-0101f279a9c8c24ec8783f21287568ab.js
       I, [2014-07-21T09:36:56.005265 #1017]  INFO -- : Writing /tmp/build_b8be5592-5246-464e-ba6a-1c052a86b661/public/assets/application-d0e6f02b399570c37fedbe45a0393e35.css
       Asset precompilation completed (7.07s)
       Cleaning assets
       Running: rake assets:clean
-----&gt; WARNINGS:
       No Procfile detected, using the default web server (webrick)
       https://devcenter.heroku.com/articles/ruby-default-web-server
-----&gt; Discovering process types
       Procfile declares types -&gt; (none)
       Default types for Ruby  -&gt; console, rake, web, worker

-----&gt; Compressing... done, 21.1MB
-----&gt; Launching... done, v6
       http://hfeng-demo-app.herokuapp.com/ deployed to Heroku

To git@heroku.com:hfeng-demo-app.git
 * [new branch]      master -&gt; master
hfengdeMacBook-Air:demo_app hfeng$ heroku run rake db:migrate
heroku run rake db:migrate
Running `rake db:migrate` attached to terminal... up, run.5711
Migrating to CreateUsers (20140721023511)
== 20140721023511 CreateUsers: migrating ======================================
-- create_table(:users)
   -&gt; 0.0438s
== 20140721023511 CreateUsers: migrated (0.0441s) =============================

Migrating to CreateMicroposts (20140721073734)
== 20140721073734 CreateMicroposts: migrating =================================
-- create_table(:microposts)
   -&gt; 0.0322s
== 20140721073734 CreateMicroposts: migrated (0.0324s) ========================
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Chapter 03: Mostly static pages</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>虽然rails是为冬天网页设计的,但是使用rail来设计静态的网页也有其优点
</li>
<li>首先,我们来创建一个rails项目,但是去掉rails默认的unit test部分. 并非是我们不想
做测试,而是我们要使用Rspec来做rails的测试部分
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:rails_projects hfeng$ rails new sample_app --skip-test-unit
rails new sample_app --skip-test-unit
      create
      create  README.rdoc
      create  Rakefile
      create  config.ru
      create  .gitignore
      create  Gemfile
      create  app
      create  app/assets/javascripts/application.js
      create  app/assets/stylesheets/application.css
      create  app/controllers/application_controller.rb
      create  app/helpers/application_helper.rb
      create  app/views/layouts/application.html.erb
      create  app/assets/images/.keep
      create  app/mailers/.keep
      create  app/models/.keep
      create  app/controllers/concerns/.keep
      create  app/models/concerns/.keep
      create  bin
      create  bin/bundle
      create  bin/rails
      create  bin/rake
      create  config
      create  config/routes.rb
      create  config/application.rb
      create  config/environment.rb
      create  config/environments
      create  config/environments/development.rb
      create  config/environments/production.rb
      create  config/environments/test.rb
      create  config/initializers
      create  config/initializers/backtrace_silencers.rb
      create  config/initializers/filter_parameter_logging.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/secret_token.rb
      create  config/initializers/session_store.rb
      create  config/initializers/wrap_parameters.rb
      create  config/locales
      create  config/locales/en.yml
      create  config/boot.rb
      create  config/database.yml
      create  db
      create  db/seeds.rb
      create  lib
      create  lib/tasks
      create  lib/tasks/.keep
      create  lib/assets
      create  lib/assets/.keep
      create  log
      create  log/.keep
      create  public
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/favicon.ico
      create  public/robots.txt
      create  tmp/cache
      create  tmp/cache/assets
      create  vendor/assets/javascripts
      create  vendor/assets/javascripts/.keep
      create  vendor/assets/stylesheets
      create  vendor/assets/stylesheets/.keep
         run  bundle install
Fetching gem metadata from https://rubygems.org/..........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.11
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using bundler 1.6.4
Using coffee-script-source 1.7.1
Using execjs 2.2.1
Using coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Using coffee-rails 4.0.1
Using hike 1.2.3
Using jbuilder 1.5.3
Using jquery-rails 3.1.1
Using json 1.8.1
Using tilt 1.4.1
Using sprockets 2.11.0
Using sprockets-rails 2.1.3
Using rails 4.0.8
Using rdoc 4.1.1
Using sass 3.2.19
Using sass-rails 4.0.3
Using sdoc 0.4.0
Using sqlite3 1.3.9
Using turbolinks 2.2.2
Using uglifier 2.5.3
Your bundle is complete!
Use `bundle show [gemname]` to see where a bundled gem is installed.
</pre>
</div>
</li>
<li>然后,很自然的,我们又要hack一下Gemfile
<div class="org-src-container">

<pre class="src src-diff">diff --git a/Gemfile b/Gemfile
index bb6d51a..02f186f 100644
--- a/Gemfile
+++ b/Gemfile
@@ -1,35 +1,48 @@
 source 'https://rubygems.org'
+ruby '2.0.0'
+#ruby-gemset=railstutorial_rails_4_0

 # Bundle edge Rails instead: gem 'rails', github: 'rails/rails'
 gem 'rails', '4.0.8'

-# Use sqlite3 as the database for Active Record
-gem 'sqlite3'
+group :development, :test do
+  gem 'sqlite3'
+  gem 'rspec-rails', '2.13.1'
+end
+
+group :test do
+  gem 'selenium-webdriver', '2.35.1'
+  gem 'capybara', '2.1.0'
+end

 # Use SCSS for stylesheets
-gem 'sass-rails', '~&gt; 4.0.2'
+gem 'sass-rails', '4.0.1'

 # Use Uglifier as compressor for JavaScript assets
-gem 'uglifier', '&gt;= 1.3.0'
+gem 'uglifier', '2.1.1'

 # Use CoffeeScript for .js.coffee assets and views
-gem 'coffee-rails', '~&gt; 4.0.0'
+gem 'coffee-rails', '4.0.1'

 # See https://github.com/sstephenson/execjs#readme for more supported runtimes
 # gem 'therubyracer', platforms: :ruby

 # Use jquery as the JavaScript library
-gem 'jquery-rails'
+gem 'jquery-rails', '3.0.4'

 # Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks
-gem 'turbolinks'
+gem 'turbolinks', '1.1.1'

 # Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder
-gem 'jbuilder', '~&gt; 1.2'
+gem 'jbuilder', '1.0.2'

 group :doc do
-  # bundle exec rake doc:rails generates the API under doc/api.
-  gem 'sdoc', require: false
+  gem 'sdoc', '0.3.20', require: false
+end
+
+group :production do
+  gem 'pg', '0.15.1'
+  gem 'rails_12factor', '0.0.2'
 end

 # Use ActiveModel has_secure_password
</pre>
</div>
</li>
<li>修改Gemfile之后是bundle install自然也要without production
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:sample_app hfeng$ bundle install --without production
bundle install --without production
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Bundler could not find compatible versions for gem "sprockets-rails":
  In snapshot (Gemfile.lock):
    sprockets-rails (2.1.3)

  In Gemfile:
    sass-rails (= 4.0.1) ruby depends on
      sprockets-rails (~&gt; 2.0.0) ruby

Running `bundle update` will rebuild your snapshot from scratch, using only
the gems in your Gemfile, which may resolve the conflict.
</pre>
</div>
</li>
<li>从上面看,without production的结果并不成功. 需要bundle update. 然后再bundle
install(注意,没有 &#x2013;without production了)
<div class="org-src-container">

<pre class="src src-sh">hfengdeMacBook-Air:sample_app hfeng$ bundle update --without production
bundle update --without production
Unknown switches '--without'
hfengdeMacBook-Air:sample_app hfeng$ bundle update
bundle update
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.11
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using bundler 1.6.4
Installing mini_portile 0.6.0
Building nokogiri using packaged libraries.
Building libxml2-2.8.0 for nokogiri with the following patches applied:
    - 0001-Fix-parser-local-buffers-size-problems.patch
    - 0002-Fix-entities-local-buffers-size-problems.patch
    - 0003-Fix-an-error-in-previous-commit.patch
    - 0004-Fix-potential-out-of-bound-access.patch
    - 0005-Detect-excessive-entities-expansion-upon-replacement.patch
    - 0006-Do-not-fetch-external-parsed-entities.patch
    - 0007-Enforce-XML_PARSER_EOF-state-handling-through-the-pa.patch
    - 0008-Improve-handling-of-xmlStopParser.patch
    - 0009-Fix-a-couple-of-return-without-value.patch
    - 0010-Keep-non-significant-blanks-node-in-HTML-parser.patch
    - 0011-Do-not-fetch-external-parameter-entities.patch
************************************************************************
IMPORTANT!  Nokogiri builds and uses a packaged version of libxml2.

If this is a concern for you and you want to use the system library
instead, abort this installation process and reinstall nokogiri as
follows:

    gem install nokogiri -- --use-system-libraries

If you are using Bundler, tell it to use the option:

    bundle config build.nokogiri --use-system-libraries
    bundle install

However, note that nokogiri does not necessarily support all versions
of libxml2.

For example, libxml2-2.9.0 and higher are currently known to be broken
and thus unsupported by nokogiri, due to compatibility problems and
XPath optimization bugs.
************************************************************************
Building libxslt-1.1.28 for nokogiri with the following patches applied:
    - 0001-Adding-doc-update-related-to-1.1.28.patch
    - 0002-Fix-a-couple-of-places-where-f-printf-parameters-wer.patch
    - 0003-Initialize-pseudo-random-number-generator-with-curre.patch
    - 0004-EXSLT-function-str-replace-is-broken-as-is.patch
    - 0006-Fix-str-padding-to-work-with-UTF-8-strings.patch
    - 0007-Separate-function-for-predicate-matching-in-patterns.patch
    - 0008-Fix-direct-pattern-matching.patch
    - 0009-Fix-certain-patterns-with-predicates.patch
    - 0010-Fix-handling-of-UTF-8-strings-in-EXSLT-crypto-module.patch
    - 0013-Memory-leak-in-xsltCompileIdKeyPattern-error-path.patch
    - 0014-Fix-for-bug-436589.patch
    - 0015-Fix-mkdir-for-mingw.patch
************************************************************************
IMPORTANT!  Nokogiri builds and uses a packaged version of libxslt.

If this is a concern for you and you want to use the system library
instead, abort this installation process and reinstall nokogiri as
follows:

    gem install nokogiri -- --use-system-libraries

If you are using Bundler, tell it to use the option:

    bundle config build.nokogiri --use-system-libraries
    bundle install
************************************************************************
Installing nokogiri 1.6.3.1
Installing xpath 2.0.0
Installing capybara 2.1.0
Installing ffi 1.9.3
Installing childprocess 0.5.3
Using coffee-script-source 1.7.1
Using execjs 2.2.1
Using coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Using coffee-rails 4.0.1
Installing diff-lcs 1.2.5
Using hike 1.2.3
Using jbuilder 1.0.2 (was 1.5.3)
Using jquery-rails 3.0.4 (was 3.1.1)
Using json 1.8.1
Using tilt 1.4.1
Using sprockets 2.12.1 (was 2.11.0)
Using sprockets-rails 2.0.1 (was 2.1.3)
Using rails 4.0.8
Using rdoc 3.12.2 (was 4.1.1)
Installing rspec-core 2.13.1
Installing rspec-expectations 2.13.0
Installing rspec-mocks 2.13.1
Installing rspec-rails 2.13.1
Installing rubyzip 0.9.9
Using sass 3.3.10 (was 3.2.19)
Using sass-rails 4.0.1 (was 4.0.3)
Using sdoc 0.3.20 (was 0.4.0)
Installing websocket 1.0.7
Installing selenium-webdriver 2.35.1
Using sqlite3 1.3.9
Using turbolinks 1.1.1 (was 2.2.2)
Using uglifier 2.1.1 (was 2.5.3)
Your bundle is updated!
Gems in the group production were not installed.
hfengdeMacBook-Air:sample_app hfeng$ bundle install
bundle install --without production
Using rake 10.3.2
Using i18n 0.6.11
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.40
Using activesupport 4.0.8
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.8
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.8
Using activemodel 4.0.8
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.8
Using mini_portile 0.6.0
Using nokogiri 1.6.3.1
Using xpath 2.0.0
Using capybara 2.1.0
Using ffi 1.9.3
Using childprocess 0.5.3
Using coffee-script-source 1.7.1
Using execjs 2.2.1
Using coffee-script 2.3.0
Using thor 0.19.1
Using railties 4.0.8
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using bundler 1.6.4
Using tilt 1.4.1
Using sprockets 2.12.1
Using sprockets-rails 2.0.1
Using rails 4.0.8
Using rdoc 3.12.2
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass 3.3.10
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using sqlite3 1.3.9
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
</pre>
</div>
</li>
<li>这里为什么bundle install不再加 &#x2013;withou production了?
<pre class="example">
      因为--without production是一个"remembered option", 一旦你加过一次,以后就不用再加了
</pre>
</li>
<li>这也同时解释了,我们为什么"不用bundle update"来代替"bundle install", 直接输入
一次bundle update不是比1. bundle install &#x2013;without production 2. bundle
update 3. bundle install强么?
<pre class="example">
第一个bundle install的作用,其实就是加入一个--without production的参数,
bundle update 在最后会调用bundle install, 但是如果没有第一个bundle install
那么直接bundle update的话,就会"必然"引入production, 这不是我们想要的.
所以要"三步走"
</pre>
</li>
<li>下面我们的工作,是创建一个动态的.secret:
<ul class="org-ul">
<li>首先,在root文件夹下面创建一个叫做.secret的文件(不加也可以,一会自动创建)
</li>
<li>其次,在.gitignore里面加入这个文件,防止其被版本管理
<div class="org-src-container">

<pre class="src src-diff">    Modified   .gitignore
diff --git a/.gitignore b/.gitignore
index 6a502e9..b603f56 100644
--- a/.gitignore
+++ b/.gitignore
@@ -14,3 +14,4 @@
 # Ignore all logfiles and tempfiles.
 /log/*.log
 /tmp
+.secret
</pre>
</div>
</li>
<li>更改config/initializers/secret_token.rb文件如下
<div class="org-src-container">

<pre class="src src-ruby"># Be sure to restart your server when you modify this file.

# Your secret key is used for verifying the integrity of signed cookies.
# If you change this key, all old signed cookies will become invalid!

# Make sure the secret is at least 30 characters and all random,
# no regular words or you'll be exposed to dictionary attacks.
# You can use `rake secret` to generate a secure secret key.

# Make sure your secret_key_base is kept private
# if you're sharing your code publicly.
require 'securerandom'

def secure_token
  token_file = Rails.root.join('.secret')
  if File.exist?(token_file)
    # Use the existing token.
    File.read(token_file).chomp
  else
    # Generate a new token and store it in token_file
    token = SecureRandom.hex(64)
    File.write(token_file, token)
    token
  end
end

SampleApp::Application.config.secret_key_base = secure_token
</pre>
</div>
</li>
</ul>
</li>
<li>好的,万事俱备,下面我们来看看如何使用rspec来替代Test::Unit
<div class="org-src-container">

<pre class="src src-ruby">hfeng@ubuntu1204:~/rails_projects/sample_app$ rails generate rspec:install
      create  .rspec
      create  spec
      create  spec/spec_helper.rb
</pre>
</div>
</li>
<li>然后我们像往常一样
<ol class="org-ol">
<li>创建heroku(重命名)
<div class="org-src-container">

<pre class="src src-sh">heroku login
heroku create
heroku rename
</pre>
</div>
</li>
<li>加入heroku的版本管理
<div class="org-src-container">

<pre class="src src-sh">git push heroku master
</pre>
</div>
</li>
<li>运行数据库更改
<div class="org-src-container">

<pre class="src src-sh">heroku run rakd db:migrate
</pre>
</div>
</li>
<li>还可以看log
<div class="org-src-container">

<pre class="src src-sh">heroku log
</pre>
</div>
</li>
</ol>
</li>
</ul>
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Static pages</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>墨迹这么久之后,终于开始要探究static网页的内容了,为此我们专门创建一个branch
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ git checkout -b static-pages
git checkout -b static-pages
Switched to a new branch 'static-pages'
hfeng@ubuntu1204:~/rails_projects/sample_app$ git branch -a
git branch -a
  master
* static-pages
  remotes/heroku/master
  remotes/origin/master
</pre>
</div>
</li>
<li>好,我们的任务开始了,我们要创建三个静态网页:
<ol class="org-ol">
<li>Home page
</li>
<li>Help page
</li>
<li>About page
</li>
</ol>
</li>
<li>我们希望这三个静态网页都由一个controller来管理,这个controller叫做StaticPage
controller从这个名字你就能猜出来,以后有了新的其他的静态网页,我也想用这个controller,
这从一个侧面揭示了controller的一个事实:
<pre class="example">
controller从某种意义上来说,是某些相关页面的"容器".
</pre>
</li>
<li>下面就是创建controller的过程,创建的时候可以同时初始化一些页面,我们这里把home
和help都写上了,about留着以后写
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rails generate controller StaticPages home help --no-test-framework
rails generate controller StaticPages home help --no-test-framework
      create  app/controllers/static_pages_controller.rb
       route  get "static_pages/help"
       route  get "static_pages/home"
      invoke  erb
      create    app/views/static_pages
      create    app/views/static_pages/home.html.erb
      create    app/views/static_pages/help.html.erb
      invoke  helper
      create    app/helpers/static_pages_helper.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/static_pages.js.coffee
      invoke    scss
      create      app/assets/stylesheets/static_pages.css.scss
</pre>
</div>
</li>
<li>尽管你很小心,有时候,你还是会出错误,而自动生成代码一般是好几个文件,你也不知道
到底改了什么,这个时候具备undo是非常重要的. 而rails正好有这个功能
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ git checkout -b undo-test
git checkout -b undo-test
A   app/assets/javascripts/static_pages.js.coffee
A   app/assets/stylesheets/static_pages.css.scss
A   app/controllers/static_pages_controller.rb
A   app/helpers/static_pages_helper.rb
A   app/views/static_pages/help.html.erb
A   app/views/static_pages/home.html.erb
M   config/routes.rb
Switched to a new branch 'undo-test'
hfeng@ubuntu1204:~/rails_projects/sample_app$ git branch
git branch
  master
  static-pages
* undo-test
hfeng@ubuntu1204:~/rails_projects/sample_app$ git add .
git add .
hfeng@ubuntu1204:~/rails_projects/sample_app$ git commit -m "StaticPages controller"
git commit -m "StaticPages controller"
[undo-test 0293b1f] StaticPages controller
 7 files changed, 21 insertions(+)
 create mode 100644 app/assets/javascripts/static_pages.js.coffee
 create mode 100644 app/assets/stylesheets/static_pages.css.scss
 create mode 100644 app/controllers/static_pages_controller.rb
 create mode 100644 app/helpers/static_pages_helper.rb
 create mode 100644 app/views/static_pages/help.html.erb
 create mode 100644 app/views/static_pages/home.html.erb
hfeng@ubuntu1204:~/rails_projects/sample_app$ git log -2
git log -2
commit 0293b1f819b2cdac66dda1e94c5ad560ca11fed2
Author: harri feng &lt;harrifeng@gmail.com&gt;
Date:   Sat Jul 26 21:08:41 2014 +0800

    StaticPages controller

commit 932b6873d0031f65aa88723735e44da7984a3303
Author: harri feng &lt;harrifeng@gmail.com&gt;
Date:   Sat Jul 26 20:35:06 2014 +0800

    improve the readme
hfeng@ubuntu1204:~/rails_projects/sample_app$ git checkout static-pages
git checkout static-pages
Switched to branch 'static-pages'
hfeng@ubuntu1204:~/rails_projects/sample_app$ git log -2
git log -2
commit 932b6873d0031f65aa88723735e44da7984a3303
Author: harri feng &lt;harrifeng@gmail.com&gt;
Date:   Sat Jul 26 20:35:06 2014 +0800

    improve the readme

commit 23fc2ef76a4c7dcc78b0ac0184876e5dae5032d0
Author: harri feng &lt;harrifeng@gmail.com&gt;
Date:   Sat Jul 26 20:34:41 2014 +0800

    use RSpec instead of Test::Unit
hfeng@ubuntu1204:~/rails_projects/sample_app$ git diff static-pages --stat
git diff static-pages --stat
 app/assets/javascripts/static_pages.js.coffee |    3 +++
 app/assets/stylesheets/static_pages.css.scss  |    3 +++
 app/controllers/static_pages_controller.rb    |    7 +++++++
 app/helpers/static_pages_helper.rb            |    2 ++
 app/views/static_pages/help.html.erb          |    2 ++
 app/views/static_pages/home.html.erb          |    2 ++
 config/routes.rb                              |    2 ++
 7 files changed, 21 insertions(+)
hfeng@ubuntu1204:~/rails_projects/sample_app$ rails destroy controller StaticPages home help --no-test-framework
rails destroy controller StaticPages home help --no-test-framework
      remove  app/controllers/static_pages_controller.rb
       route  get "static_pages/help"
       route  get "static_pages/home"
      invoke  erb
      remove    app/views/static_pages
      remove    app/views/static_pages/home.html.erb
      remove    app/views/static_pages/help.html.erb
      invoke  helper
      remove    app/helpers/static_pages_helper.rb
      invoke  assets
      invoke    coffee
      remove      app/assets/javascripts/static_pages.js.coffee
      invoke    scss
      remove      app/assets/stylesheets/static_pages.css.scss
hfeng@ubuntu1204:~/rails_projects/sample_app$ git branch
git branch
  master
  static-pages
* undo-test
hfeng@ubuntu1204:~/rails_projects/sample_app$ git diff static-pages --stat
git diff static-pages --stat
hfeng@ubuntu1204:~/rails_projects/sample_app$ git log -2
git log -2
commit 0293b1f819b2cdac66dda1e94c5ad560ca11fed2
Author: harri feng &lt;harrifeng@gmail.com&gt;
Date:   Sat Jul 26 21:08:41 2014 +0800

    StaticPages controller

commit 932b6873d0031f65aa88723735e44da7984a3303
Author: harri feng &lt;harrifeng@gmail.com&gt;
Date:   Sat Jul 26 20:35:06 2014 +0800

    improve the readme
hfeng@ubuntu1204:~/rails_projects/sample_app$ git status
git status
# On branch undo-test
# Changes not staged for commit:
#   (use "git add/rm &lt;file&gt;..." to update what will be committed)
#   (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
#
#   deleted:    app/assets/javascripts/static_pages.js.coffee
#   deleted:    app/assets/stylesheets/static_pages.css.scss
#   deleted:    app/controllers/static_pages_controller.rb
#   deleted:    app/helpers/static_pages_helper.rb
#   deleted:    app/views/static_pages/help.html.erb
#   deleted:    app/views/static_pages/home.html.erb
#   modified:   config/routes.rb
#
no changes added to commit (use "git add" and/or "git commit -a")
</pre>
</div>
</li>
<li>数据库也有创建,和"破坏(回滚)"的方法
<div class="org-src-container">

<pre class="src src-sh"># generate
rake db:migrate

# destroy
rake db:rollback
</pre>
</div>
</li>
<li>你可以看到,我们这里使用了"驼峰"命名法写StaticPages,这个会产生一个名字为static_pages_controller.rb
的文件. 当然了,其实你就算写static_pages代替StaticPages,也是可以的(rails内部
使用undersocre命令来转换把所有"驼峰"命名转换成"蛇形"命名). 借助上面的branch
undo-test我们来看看使用"蛇形"命名的结果: 我们可以看到,只有一行注释不同.
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ git checkout static-pages
git checkout static-pages
Switched to branch 'static-pages'
hfeng@ubuntu1204:~/rails_projects/sample_app$ git diff undo-test --stat
git diff undo-test --stat
 app/assets/javascripts/static_pages.js.coffee |    3 ---
 app/assets/stylesheets/static_pages.css.scss  |    3 ---
 app/controllers/static_pages_controller.rb    |    7 -------
 app/helpers/static_pages_helper.rb            |    2 --
 app/views/static_pages/help.html.erb          |    2 --
 app/views/static_pages/home.html.erb          |    2 --
 config/routes.rb                              |    2 --
 7 files changed, 21 deletions(-)
hfeng@ubuntu1204:~/rails_projects/sample_app$ rails generate controller static_pages home help --no-test-framework
rails generate controller static_pages home help --no-test-framework
      create  app/controllers/static_pages_controller.rb
       route  get "static_pages/help"
       route  get "static_pages/home"
      invoke  erb
      create    app/views/static_pages
      create    app/views/static_pages/home.html.erb
      create    app/views/static_pages/help.html.erb
      invoke  helper
      create    app/helpers/static_pages_helper.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/static_pages.js.coffee
      invoke    scss
      create      app/assets/stylesheets/static_pages.css.scss
hfeng@ubuntu1204:~/rails_projects/sample_app$ git diff undo-test --cached --stat
git diff undo-test --cached --stat
 app/assets/stylesheets/static_pages.css.scss |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
hfeng@ubuntu1204:~/rails_projects/sample_app$ git diff undo-test --cached
git diff undo-test --cached
diff --git a/app/assets/stylesheets/static_pages.css.scss b/app/assets/stylesheets/static_pages.css.scss
index d55836c..40608b2 100644
--- a/app/assets/stylesheets/static_pages.css.scss
+++ b/app/assets/stylesheets/static_pages.css.scss
@@ -1,3 +1,3 @@
-// Place all the styles related to the StaticPages controller here.
+// Place all the styles related to the static_pages controller here.
 // They will automatically be included in application.css.
 // You can use Sass (SCSS) here: http://sass-lang.com/
</pre>
</div>
</li>
<li>我们的routes.rb里面多了这么几行
<div class="org-src-container">

<pre class="src src-diff">    Modified   config/routes.rb
diff --git a/config/routes.rb b/config/routes.rb
index d2facc2..f3d176d 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -1,4 +1,6 @@
 SampleApp::Application.routes.draw do
+  get "static_pages/home"
+  get "static_pages/help"
   # The priority is based upon order of creation: first created -&gt; highest priority.
   # See how all your routes lay out with "rake routes".
</pre>
</div>
</li>
<li>我们就会从get static_pages/home这一句里面得到如下信息:我们使用GET method的
时候,会触发static_pages_controller里面的home页面

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch3/static-page-home.png" alt="static-page-home.png" />
</p>
<p><span class="figure-number">Figure 4:</span> static-page-home.png</p>
</div>
</li>
<li>如果我们看看StaticPages Controller的代码的话,我们就会发现. 其并不是RESTful的
API, 这是因为这个世界上也没有绝对的事情, 静态的网页很难抽象出resource的概念,
也就不需要RESTful API啦.
<div class="org-src-container">

<pre class="src src-ruby"># app/controllers/static_pages_controller.rb
class StaticPagesController &lt; ApplicationController
  def home
  end

  def help
  end
end
</pre>
</div>
</li>
<li>我们可以看到home和help两个函数是空的!但是由于StaticPagesController继承了
ApplicationController,所以所有的子函数都"默认自带"转发请求到"View"的功能.到
哪个view呢?还是通过"名字"来的!,刚才创建了两个ViewPage,一个是为home 函数准备
的,一个是为help函数准备的.
<div class="org-src-container">

<pre class="src src-ruby"># app/view/static_pages/home.html.erb
&lt;h1&gt;StaticPages#home&lt;/h1&gt;
&lt;p&gt;Find me in app/views/static_pages/home.html.erb&lt;/p&gt;

# app/view/static_pages/help.html.erb
&lt;h1&gt;StaticPages#help&lt;/h1&gt;
&lt;p&gt;Find me in app/views/static_pages/help.html.erb&lt;/p&gt;
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Our first tests</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>Rails是一种强调behavior的框架(对于内部如何实现,不是特别关心), 所以它使用了
一种叫做BDD(Behavior-driven development)的开发模式
</li>
<li>rails里面主要有两种类型的测试:
<ul class="org-ul">
<li>integration test: 模仿用户使用浏览器来和我们的server进行交互
</li>
<li>unit test
</li>
</ul>
</li>
<li>BDD是TDD(Test-driven development)的一种变形, 强调在写代码之前,先写测试, 当然
了凡事没有绝对,并不是一定要每次都先写测试
</li>
</ul>
</div>
<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1">Test-driven development</h4>
<div class="outline-text-4" id="text-3-2-1">
<ul class="org-ul">
<li>在test-driven的开发流程中,我们要遵循一个"Red, Green, Refactor"的过程:
<ul class="org-ul">
<li>red: 首先写一个会fail的测试
</li>
<li>green: 写一个成功的fail的测试
</li>
<li>refactor: 不改变函数,重构函数内容,再运行测试,保证测试能够成功
</li>
</ul>
</li>
<li>下面开始写第一个integration测试用例:
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rails generate integration_test static_pages
      invoke  rspec
      create    spec/requests/static_pages_spec.rb
</pre>
</div>
</li>
<li>首先写一个red的测试:
<div class="org-src-container">

<pre class="src src-diff">diff --git a/spec/requests/static_pages_spec.rb b/spec/requests/static_pages_spec.rb
index 7c64515..f3993c0 100644
--- a/spec/requests/static_pages_spec.rb
+++ b/spec/requests/static_pages_spec.rb
@@ -1,11 +1,10 @@
 require 'spec_helper'

 describe "Static Pages" do
-  describe "GET /static_pages" do
-    it "works! (now write some real specs)" do
-      # Run the generator again with the --webrat flag if you want to use webrat methods/matchers
-      get static_pages_index_path
-      response.status.should be(200)
+  describe "Home page" do
+    it "should have the content 'Sample App'" do
+      visit '/static_pages/home'
+      expect(page).to have_content('Sample App')
     end
   end
 end
</pre>
</div>
</li>
<li>测试要能够使用visit函数,必须在helper函数里面加上如下配置
<div class="org-src-container">

<pre class="src src-diff">diff --git a/spec/spec_helper.rb b/spec/spec_helper.rb
index 943bc19..031f92c 100644
--- a/spec/spec_helper.rb
+++ b/spec/spec_helper.rb
@@ -39,4 +39,5 @@ RSpec.configure do |config|
   # the seed, which is printed after each run.
   #     --seed 1234
   config.order = "random"
+  config.include Capybara::DSL
 end
</pre>
</div>
</li>
<li>测试的结果必然是寒心的.
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rspec spec/requests/static_pages_spec.rb
F

Failures:

  1) Static Pages Home page should have the content 'Sample App'
     Failure/Error: expect(page).to have_content('Sample App')
       expected #has_content?("Sample App") to return true, got false
     # ./spec/requests/static_pages_spec.rb:7:in `block (3 levels) in &lt;top (required)&gt;'

Finished in 0.33291 seconds
1 example, 1 failure

Failed examples:

rspec ./spec/requests/static_pages_spec.rb:5 # Static Pages Home page should have the content 'Sample App'

Randomized with seed 44199
</pre>
</div>
</li>
<li>在页面添加必要的字符,就通过了测试,来到了green stage
<div class="org-src-container">

<pre class="src src-diff">diff --git a/app/views/static_pages/home.html.erb b/app/views/static_pages/home.html.erb
index af94c7f..d4f4fe7 100644
--- a/app/views/static_pages/home.html.erb
+++ b/app/views/static_pages/home.html.erb
@@ -1,2 +1,6 @@
-&lt;h1&gt;StaticPages#home&lt;/h1&gt;
-&lt;p&gt;Find me in app/views/static_pages/home.html.erb&lt;/p&gt;
+&lt;h1&gt;Sample App&lt;/h1&gt;
+&lt;p&gt;
+  This is the ome page for the
+  &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
+  sample application.
+&lt;/p&gt;
</pre>
</div>
</li>
<li>如法炮制,就得到了help的green stage
<div class="org-src-container">

<pre class="src src-diff">diff --git a/app/views/static_pages/help.html.erb b/app/views/static_pages/help.html.erb
index 61896f5..bb57b44 100644
--- a/app/views/static_pages/help.html.erb
+++ b/app/views/static_pages/help.html.erb
@@ -1,2 +1,7 @@
-&lt;h1&gt;StaticPages#help&lt;/h1&gt;
-&lt;p&gt;Find me in app/views/static_pages/help.html.erb&lt;/p&gt;
+&lt;h1&gt;Help&lt;/h1&gt;
+&lt;p&gt;
+  Get help on the Ruby on Rails Tutorial at the
+  &lt;a href="http://railstutorial.org/help"&gt;Rails Tutorial help page&lt;/a&gt;
+  To get help on this sample app, see the
+  &lt;a href="http://railstutorial.org/book"&gt;Rails Tutorial book&lt;/a&gt;
+&lt;/p&gt;
diff --git a/spec/requests/static_pages_spec.rb b/spec/requests/static_pages_spec.rb
index 432450c..2f65d48 100644
--- a/spec/requests/static_pages_spec.rb
+++ b/spec/requests/static_pages_spec.rb
@@ -2,9 +2,17 @@ require 'spec_helper'

 describe "Static Pages" do
   describe "Home page" do
+
     it "should have the content 'Sample App'" do
       visit '/static_pages/home'
       expect(page).to have_content('Sample App')
     end
   end
+
+  describe "Help page" do
+    it "should have the content 'Help'" do
+      visit '/static_pages/help'
+      expect(page).to have_content('Help')
+    end
+  end
 end
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2">Adding a page</h4>
<div class="outline-text-4" id="text-3-2-2">
<ul class="org-ul">
<li>我们前面故意遗漏了一个About的页面,这里就是通过"Red, Green, Refator"的三步来添加.
</li>
</ul>
</div>
<div id="outline-container-sec-3-2-2-1" class="outline-5">
<h5 id="sec-3-2-2-1">Red:</h5>
<div class="outline-text-5" id="text-3-2-2-1">
<ul class="org-ul">
<li>先添加测试如下
<div class="org-src-container">

<pre class="src src-diff">diff --git a/spec/requests/static_pages_spec.rb b/spec/requests/static_pages_spec.rb
index 2f65d48..23cddaf 100644
--- a/spec/requests/static_pages_spec.rb
+++ b/spec/requests/static_pages_spec.rb
@@ -15,4 +15,12 @@ describe "Static Pages" do
       expect(page).to have_content('Help')
     end
   end
+
+  describe "About page" do
+    it "should have the content 'About Us'" do
+      visit '/static_pages/about'
+      expect(page).to have_content('About Us')
+    end
+  end
+
 end
</pre>
</div>
</li>
<li>然后,测试很"如所料"的挂掉了
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rspec spec/requests/static_pages_spec.rb
..F

Failures:

  1) Static Pages About page should have the content 'About Us'
     Failure/Error: visit '/static_pages/about'
     ActionController::RoutingError:
       No route matches [GET] "/static_pages/about"
     # ./spec/requests/static_pages_spec.rb:21:in `block (3 levels) in &lt;top (required)&gt;'

Finished in 0.0552 seconds
3 examples, 1 failure

Failed examples:

rspec ./spec/requests/static_pages_spec.rb:20 # Static Pages About page should have the content 'About Us'

Randomized with seed 43839
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-2-3" class="outline-4">
<h4 id="sec-3-2-3">Green</h4>
<div class="outline-text-4" id="text-3-2-3">
<ul class="org-ul">
<li>上面的抱怨是我们根本没有/static_pages/about.这是routes没设置对, 改之
<div class="org-src-container">

<pre class="src src-diff">diff --git a/config/routes.rb b/config/routes.rb
index f3d176d..d13c93c 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -1,6 +1,7 @@
 SampleApp::Application.routes.draw do
   get "static_pages/home"
   get "static_pages/help"
+  get "static_pages/about"
   # The priority is based upon order of creation: first created -&gt; highest priority.
   # See how all your routes lay out with "rake routes".
</pre>
</div>
</li>
<li>依然不对,抱怨controller没有相应的函数
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rspec spec/requests/static_pages_spec.rb
F..

Failures:

  1) Static Pages About page should have the content 'About Us'
     Failure/Error: visit '/static_pages/about'
     AbstractController::ActionNotFound:
       The action 'about' could not be found for StaticPagesController
     # ./spec/requests/static_pages_spec.rb:21:in `block (3 levels) in &lt;top (required)&gt;'
</pre>
</div>
</li>
<li>那么我们就加上响应的函数
<div class="org-src-container">

<pre class="src src-diff">diff --git a/app/controllers/static_pages_controller.rb b/app/controllers/static_pages_controller.rb
index c76b925..19f79a9 100644
--- a/app/controllers/static_pages_controller.rb
+++ b/app/controllers/static_pages_controller.rb
@@ -4,4 +4,7 @@ class StaticPagesController &lt; ApplicationController

   def help
   end
+
+  def about
+  end
 end
</pre>
</div>
</li>
<li>这次的抱怨是没有template
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rspec spec/requests/static_pages_spec.rb
F..

Failures:

  1) Static Pages About page should have the content 'About Us'
     Failure/Error: visit '/static_pages/about'
     ActionView::MissingTemplate:
       Missing template static_pages/about, application/about with {:locale=&gt;[:en], :formats=&gt;[:html], :handlers=&gt;[:erb, :builder, :raw, :ruby, :jbuilder, :coffee]}. Searched in:
         * "/home/hfeng/rails_projects/sample_app/app/views"
     # ./spec/requests/static_pages_spec.rb:21:in `block (3 levels) in &lt;top (required)&gt;'

Finished in 0.05173 seconds
3 examples, 1 failure

Failed examples:

rspec ./spec/requests/static_pages_spec.rb:20 # Static Pages About page should have the content 'About Us'

Randomized with seed 63833
</pre>
</div>
</li>
<li>没有template其实就是没有View,然后我们添加一下
<div class="org-src-container">

<pre class="src src-html">&lt;!-- sample_app/app/views/static_pages/about.html.erb --&gt;

&lt;h1&gt;About Us&lt;/h1&gt;
&lt;p&gt;
  The &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
  is a project to make a book and screencasts to teach web development
  with &lt;a href="http://rubyonrails.org/"&gt;Ruby on Rails&lt;/a&gt;. This
  is the sample application for the tutorial.
&lt;/p&gt;
</pre>
</div>
</li>
<li>这下终于green了
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rspec spec/requests/static_pages_spec.rb
...

Finished in 0.05589 seconds
3 examples, 0 failures

Randomized with seed 39259
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-2-4" class="outline-4">
<h4 id="sec-3-2-4">Refactor</h4>
<div class="outline-text-4" id="text-3-2-4">
<ul class="org-ul">
<li>现阶段我们还没有重构的必要,但是拥有健壮的测试是重构的基础.
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Slightly dynamic pages</h3>
<div class="outline-text-3" id="text-3-3">
</div><div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1">Testing a title change</h4>
<div class="outline-text-4" id="text-3-3-1">
<ul class="org-ul">
<li>这次我们是要满足title包含(注意是包含,不是完全匹配)某些字符
</li>
<li>首先我们还是要做red part,所以得把rails提供的默认的layout给先屏蔽掉
<div class="org-src-container">

<pre class="src src-sh">mv app/views/layouts/application.html.erb foobar
</pre>
</div>
</li>
<li>然后是更改测试代码
<div class="org-src-container">

<pre class="src src-diff">@@ -2,11 +2,14 @@ require 'spec_helper'

 describe "Static Pages" do
   describe "Home page" do
-
     it "should have the content 'Sample App'" do
       visit '/static_pages/home'
       expect(page).to have_content('Sample App')
     end
+    it "should have the right title 'Home'" do
+      visit '/static_pages/home'
+      expect(page).to have_title("Ruby on Rails Tutorial Sample App | Home")
+    end
   end

   describe "Help page" do
@@ -14,6 +17,10 @@ describe "Static Pages" do
       visit '/static_pages/help'
       expect(page).to have_content('Help')
     end
+    it "should have the right title 'Help'" do
+      visit '/static_pages/help'
+      expect(page).to have_title("Ruby on Rails Tutorial Sample App | Help")
+    end
   end

   describe "About page" do
@@ -21,6 +28,9 @@ describe "Static Pages" do
       visit '/static_pages/about'
       expect(page).to have_content('About Us')
     end
+    it "should have the right title 'About Us'" do
+      visit '/static_pages/about'
+      expect(page).to have_title("Ruby on Rails Tutorial Sample App | About Us")
+    end
   end
-
 end
</pre>
</div>
</li>
<li>注定凄凉的结果
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rspec spec/requests/static_pages_spec.rb
F.F.F.

Failures:

  1) Static Pages Home page should have the right title 'Home'
     Failure/Error: expect(page).to have_title("Ruby on Rails Tutorial Sample App | Home")
       expected #has_title?("Ruby on Rails Tutorial Sample App | Home") to return true, got false
     # ./spec/requests/static_pages_spec.rb:11:in `block (3 levels) in &lt;top (required)&gt;'

  2) Static Pages Help page should have the right title 'Help'
     Failure/Error: expect(page).to have_title("Ruby on Rails Tutorial Sample App | Help")
       expected #has_title?("Ruby on Rails Tutorial Sample App | Help") to return true, got false
     # ./spec/requests/static_pages_spec.rb:22:in `block (3 levels) in &lt;top (required)&gt;'

  3) Static Pages About page should have the right title 'About Us'
     Failure/Error: expect(page).to have_title("Ruby on Rails Tutorial Sample App | About Us")
       expected #has_title?("Ruby on Rails Tutorial Sample App | About Us") to return true, got false
     # ./spec/requests/static_pages_spec.rb:33:in `block (3 levels) in &lt;top (required)&gt;'

Finished in 0.05635 seconds
6 examples, 3 failures

Failed examples:

rspec ./spec/requests/static_pages_spec.rb:9 # Static Pages Home page should have the right title 'Home'
rspec ./spec/requests/static_pages_spec.rb:20 # Static Pages Help page should have the right title 'Help'
rspec ./spec/requests/static_pages_spec.rb:31 # Static Pages About page should have the right title 'About Us'

Randomized with seed 2602
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-3-2" class="outline-4">
<h4 id="sec-3-3-2">Passing title tests</h4>
<div class="outline-text-4" id="text-3-3-2">
<ul class="org-ul">
<li>下面就要来让这些测试通过啦,想通过也就很简单,让他们的title含有响应字符就可以了
<ul class="org-ul">
<li>对于home来说就是
<div class="org-src-container">

<pre class="src src-html">&lt;!-- app/views/static_pages/home.html.erb --&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Ruby on Rails Tutorial Sample App | Home&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Sample App&lt;/h1&gt;
    &lt;p&gt;
      This is the home page for the
      &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
      sample application.
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</li>
<li>对于help来说就是
<div class="org-src-container">

<pre class="src src-html">&lt;!-- app/views/static_pages/help.html.erb --&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Ruby on Rails Tutorial Sample App | Help&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Sample App&lt;/h1&gt;
    &lt;p&gt;
      This is the help page for the
      &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
      sample application.
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</li>
<li>对于about来说就是
<div class="org-src-container">

<pre class="src src-html">&lt;!-- app/views/static_pages/about.html.erb --&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Ruby on Rails Tutorial Sample App | About Us&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Sample App&lt;/h1&gt;
    &lt;p&gt;
      This is the about page for the
      &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
      sample application.
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-3-3" class="outline-4">
<h4 id="sec-3-3-3">Embedded Ruby</h4>
<div class="outline-text-4" id="text-3-3-3">
<ul class="org-ul">
<li>上面三个Html页面最大的特点,就是"重复", Rails是为了DRY原则设计的一个框架,如
此频繁的重复肯定无法容忍.需要通过某些方式引入"变量",替代可变部分.
</li>
<li>以Home为例, 其他类似
<div class="org-src-container">

<pre class="src src-html">&lt;!-- app/views/static_pages/home.html.erb --&gt;
&lt;% provide(:title, 'Home') %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Ruby on Rails Tutorial Sample App | &lt;%= yield(:title) %&gt;&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Sample App&lt;/h1&gt;
    &lt;p&gt;
      This is the home page for the
      &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
      sample application.
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-3-4" class="outline-4">
<h4 id="sec-3-3-4">Eliminating duplication with layouts</h4>
<div class="outline-text-4" id="text-3-3-4">
<ul class="org-ul">
<li>为每个html.erb页面在头上加上如下这么一句, 肯定是非常麻烦的
<div class="org-src-container">

<pre class="src src-html">&lt;% provide(:title, 'Foo') %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Ruby on Rails Tutorial Sample App | &lt;%= yield(:title) %&gt;&lt;/title&gt;
  &lt;/head&gt;


  &lt;!-- .... --&gt;
&lt;/html&gt;
</pre>
</div>
</li>
<li>rails的解决办法,是把相同的部分抽出来,设计成layout, 然后每个页面都include layout
</li>
<li>在默认的模板生成的代码之下,只需要更改一部分就可以得到预想的功能
<div class="org-src-container">

<pre class="src src-diff"> &lt;html&gt;
 &lt;head&gt;
-  &lt;title&gt;SampleApp&lt;/title&gt;
+  &lt;title&gt;Ruby on Rails Tutorial Sample App | &lt;% yield(:title) %&gt;&lt;/title&gt;
</pre>
</div>
</li>
<li>我们顺便来研究下app/views/layouts/application.html.erb的全部代码
<div class="org-src-container">

<pre class="src src-ruby">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Ruby on Rails Tutorial Sample App | &lt;% yield(:title) %&gt;&lt;/title&gt;
  &lt;%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" =&gt; true %&gt;
  &lt;%= javascript_include_tag "application", "data-turbolinks-track" =&gt; true %&gt;
  &lt;%= csrf_meta_tags %&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;%= yield %&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</li>
<li>代码有这个几个需要注意的点:
<ul class="org-ul">
<li>&lt;%= stylesheet_lik_tag %&gt;是引入style
</li>
<li>&lt;%= javascript_include_tag %&gt;是引入javascript
</li>
<li>&lt;%= csrf_meta_tags %&gt;的引入,是为了防止某些恶意攻击
</li>
<li>&lt;% yield(:title) %&gt; 就是会使用对应页面(比如home.html.erb)的:title的值啦
</li>
<li>&lt;%= yield %&gt; 这个很关键, 对应页面(比如home.html.erb)就会加载到这个地方来.
对应页面就像block一样,被引入,然后在这个地方和layout结合成一个页面.用法和
ruby的block很类似.
</li>
</ul>
</li>
<li>对html.erb稍加改动
<div class="org-src-container">

<pre class="src src-diff">diff --git a/app/views/static_pages/about.html.erb b/app/views/static_pages/about.html.erb
index 463bdb3..26012f2 100644
--- a/app/views/static_pages/about.html.erb
+++ b/app/views/static_pages/about.html.erb
@@ -1,5 +1,4 @@
-&lt;!-- sample_app/app/views/static_pages/about.html.erb --&gt;
-
+&lt;% provide(:title, 'About Us') %&gt;
 &lt;h1&gt;About Us&lt;/h1&gt;
 &lt;p&gt;
   The &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
    Modified   app/views/static_pages/help.html.erb
diff --git a/app/views/static_pages/help.html.erb b/app/views/static_pages/help.html.erb
index bb57b44..50245e4 100644
--- a/app/views/static_pages/help.html.erb
+++ b/app/views/static_pages/help.html.erb
@@ -1,3 +1,4 @@
+&lt;% provide(:title, 'Help') %&gt;
 &lt;h1&gt;Help&lt;/h1&gt;
 &lt;p&gt;
   Get help on the Ruby on Rails Tutorial at the
    Modified   app/views/static_pages/home.html.erb
diff --git a/app/views/static_pages/home.html.erb b/app/views/static_pages/home.html.erb
index d4f4fe7..f184b43 100644
--- a/app/views/static_pages/home.html.erb
+++ b/app/views/static_pages/home.html.erb
@@ -1,3 +1,4 @@
+&lt;% provide(:title, 'Home') %&gt;
 &lt;h1&gt;Sample App&lt;/h1&gt;
 &lt;p&gt;
   This is the ome page for the
    Modified   spec/requests/static_pages_spec.rb
</pre>
</div>
</li>
<li>结果就很满意啦(Green stage)
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rspec spec/requests/static_pages_spec.rb
......

Finished in 0.06567 seconds
6 examples, 0 failures

Randomized with seed 19940
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">Conclusion</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li>操作做完以后,把branch更改后merge到master
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ git status
# On branch static-pages
# Changes not staged for commit:
#   (use "git add &lt;file&gt;..." to update what will be committed)
#   (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
#
#   modified:   app/views/layouts/application.html.erb
#   modified:   app/views/static_pages/about.html.erb
#   modified:   app/views/static_pages/help.html.erb
#   modified:   app/views/static_pages/home.html.erb
#   modified:   spec/requests/static_pages_spec.rb
#
no changes added to commit (use "git add" and/or "git commit -a")
hfeng@ubuntu1204:~/rails_projects/sample_app$ git add .
hfeng@ubuntu1204:~/rails_projects/sample_app$ git branch
  master
* static-pages
  undo-test
hfeng@ubuntu1204:~/rails_projects/sample_app$ git add .
hfeng@ubuntu1204:~/rails_projects/sample_app$ git commit -m "Finish static pages"
[static-pages 77fb631] Finish static pages
 5 files changed, 17 insertions(+), 6 deletions(-)
hfeng@ubuntu1204:~/rails_projects/sample_app$ git checkout master
Switched to branch 'master'
hfeng@ubuntu1204:~/rails_projects/sample_app$ git merge static-pages
Updating 932b687..77fb631
Fast-forward
 app/assets/javascripts/static_pages.js.coffee |    3 +++
 app/assets/stylesheets/static_pages.css.scss  |    3 +++
 app/controllers/static_pages_controller.rb    |   10 +++++++
 app/helpers/static_pages_helper.rb            |    2 ++
 app/views/layouts/application.html.erb        |    4 +--
 app/views/static_pages/about.html.erb         |    8 ++++++
 app/views/static_pages/help.html.erb          |    8 ++++++
 app/views/static_pages/home.html.erb          |    7 +++++
 config/routes.rb                              |    3 +++
 spec/requests/static_pages_spec.rb            |   36 +++++++++++++++++++++++++
 spec/spec_helper.rb                           |    1 +
 11 files changed, 83 insertions(+), 2 deletions(-)
 create mode 100644 app/assets/javascripts/static_pages.js.coffee
 create mode 100644 app/assets/stylesheets/static_pages.css.scss
 create mode 100644 app/controllers/static_pages_controller.rb
 create mode 100644 app/helpers/static_pages_helper.rb
 create mode 100644 app/views/static_pages/about.html.erb
 create mode 100644 app/views/static_pages/help.html.erb
 create mode 100644 app/views/static_pages/home.html.erb
 create mode 100644 spec/requests/static_pages_spec.rb
hfeng@ubuntu1204:~/rails_projects/sample_app$ git remote -v
heroku  git@heroku.com:hfeng-sample-app.git (fetch)
heroku  git@heroku.com:hfeng-sample-app.git (push)
origin  git@github.com:harrifeng/sample_app.git (fetch)
origin  git@github.com:harrifeng/sample_app.git (push)
hfeng@ubuntu1204:~/rails_projects/sample_app$ git push origin master
Counting objects: 25, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (11/11), done.
Writing objects: 100% (13/13), 1.18 KiB, done.
Total 13 (delta 7), reused 0 (delta 0)
To git@github.com:harrifeng/sample_app.git
   932b687..77fb631  master -&gt; master
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Chapter 04: Rails-flavored Ruby</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Motivation</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>前面两章为我们展示了,即便是对ruby语言不太熟悉,也是可以开发rails项目的.但是,
这不可能一直继续,我们还是要对ruby有深入的了解,才能更好的使用rails.
</li>
<li>首先来看看上一章提到的layout
<div class="org-src-container">

<pre class="src src-web">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Ruby on Rails Tutorial Sample App | &lt;%= yield(:title) %&gt;&lt;/title&gt;
    &lt;%= stylesheet_link_tag "application", media: "all",
                                           "data-turbolinks-track" =&gt; true %&gt;
    &lt;%= javascript_include_tag "application", "data-turbolinks-track" =&gt; true %&gt;
    &lt;%= csrf_meta_tags %&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;%= yield %&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</li>
<li>其中&lt;%= %&gt;的部分,都是引入的ruby代码,比如下面的这个
<div class="org-src-container">

<pre class="src src-ruby">stylesheet_link_tag "application", media: "all", "data-turbolinks-track" =&gt; true
</pre>
</div>
</li>
<li>从API上我们可以看到函数原型是
<div class="org-src-container">

<pre class="src src-ruby">def stylesheet_link_tag(*sources)
</pre>
</div>
</li>
<li>也就是说stylesheet_link_tag的参数不限制个数,会最后组合成sources这个数组.这也
就意味着,最后一个参数如果是hash的话,可以不加括号.上面其实就是这么做的.
</li>
<li>上一章解决title的问题是通过provide一个title变量,但是如果忘了引入这个变量的
话,会出现如下不是很好看的title
<pre class="example">
Ruby on Rails Tutorial Sample App |
</pre>
</li>
<li>解决办法是让返回的基础文本"Ruby on Rails Tutorial Sample App"更加的"智能",
有title的时候加"|", 没有title的时候, 不加"|"
<div class="org-src-container">

<pre class="src src-ruby"># app/helpers/application_helper.rb
module ApplicationHelper

  # Returns the full title on a per-page basis
  def full_title(page_title)
    base_title = "Ruby on Rails Turorial Sample Aapp"
    if page_title.empty?
      base_title
    else
      "{base_title} | #{page_title}"
    end
  end
end
</pre>
</div>
</li>
<li>于是在layout里面就是这样进行配置了
<div class="org-src-container">

<pre class="src src-diff">diff --git a/app/views/layouts/application.html.erb b/app/views/layouts/application.html.erb
index 91672b9..c57717a 100644
--- a/app/views/layouts/application.html.erb
+++ b/app/views/layouts/application.html.erb
@@ -1,7 +1,7 @@
 &lt;!DOCTYPE html&gt;
 &lt;html&gt;
   &lt;head&gt;
-  &lt;title&gt;Ruby on Rails Tutorial Sample App | &lt;%= yield(:title) %&gt;&lt;/title&gt;
+  &lt;title&gt;Ruby on Rails Tutorial Sample App | &lt;%= full_title(yield(:title)) %&gt;&lt;/title&gt;
   &lt;%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" =&gt; true %&gt;
   &lt;%= javascript_include_tag "application", "data-turbolinks-track" =&gt; true %&gt;
   &lt;%= csrf_meta_tags %&gt;
</pre>
</div>
</li>
<li>然后我们修改testcase,会fail testcase
<div class="org-src-container">

<pre class="src src-diff">diff --git a/spec/requests/static_pages_spec.rb b/spec/requests/static_pages_spec.rb
index 65b2995..4686d4a 100644
--- a/spec/requests/static_pages_spec.rb
+++ b/spec/requests/static_pages_spec.rb
@@ -6,9 +6,13 @@ describe "Static Pages" do
       visit '/static_pages/home'
       expect(page).to have_content('Sample App')
     end
-    it "should have the right title 'Home'" do
+    it "should have the base title" do
       visit '/static_pages/home'
-      expect(page).to have_title("Ruby on Rails Tutorial Sample App | Home")
+      expect(page).to have_title("Ruby on Rails Tutorial Sample App")
+    end
+    it "shoudl not have a custom page title" do
+      visit '/static_pages/home'
+      expect(page).not_to have_title('| Home')
     end
   end
</pre>
</div>
</li>
<li>最后我们把home里面的开头代码去掉,就对了
<div class="org-src-container">

<pre class="src src-diff">diff --git a/app/views/static_pages/home.html.erb b/app/views/static_pages/home.html.erb
index f184b43..d4f4fe7 100644
--- a/app/views/static_pages/home.html.erb
+++ b/app/views/static_pages/home.html.erb
@@ -1,4 +1,3 @@
-&lt;% provide(:title, 'Home') %&gt;
 &lt;h1&gt;Sample App&lt;/h1&gt;
 &lt;p&gt;
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Strings and methods</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li>在rails里面学习ruby的绝佳武器是Rails console
<div class="org-src-container">

<pre class="src src-sh">hfeng@ubuntu1204:~/rails_projects/sample_app$ rails console
Loading development environment (Rails 4.0.8)
2.0.0-p481 :001 &gt;
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1">Comments</h4>
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li>ruby中的#是注释符号
<div class="org-src-container">

<pre class="src src-ruby">2.0.0-p481 :001 &gt; 17 + 42 # Integer addition
 =&gt; 59
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2">String</h4>
<div class="outline-text-4" id="text-4-2-2">
<ul class="org-ul">
<li>string在ruby里面非常灵活
<div class="org-src-container">

<pre class="src src-ruby">2.0.0-p481 :002 &gt; "" # empty string
 =&gt; ""
2.0.0-p481 :003 &gt; "foo"
 =&gt; "foo"
2.0.0-p481 :004 &gt; "foo" + "bar"
 =&gt; "foobar"
2.0.0-p481 :005 &gt; first_name = "Michael"
 =&gt; "Michael"
2.0.0-p481 :010 &gt; " #{first_name} " # String interpolation
 =&gt; " Michael "
2.0.0-p481 :011 &gt;
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2-3" class="outline-4">
<h4 id="sec-4-2-3">Printing</h4>
<div class="outline-text-4" id="text-4-2-3">
<ul class="org-ul">
<li>puts会在最后加上一个"\n", 而且返回值为nil
<div class="org-src-container">

<pre class="src src-ruby">2.0.0-p481 :013 &gt; print "hello"
hello =&gt; nil
2.0.0-p481 :014 &gt; puts "hello"
hello
 =&gt; nil
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2-4" class="outline-4">
<h4 id="sec-4-2-4">Single-quoted strings</h4>
<div class="outline-text-4" id="text-4-2-4">
<ul class="org-ul">
<li>在ruby中,单引号和双引号之间几乎完全相等,除了一个地方: 单引号不会被interpolation
<div class="org-src-container">

<pre class="src src-ruby">2.0.0-p481 :017 &gt; foo = 'bar'
 =&gt; "bar"
2.0.0-p481 :018 &gt; foo
 =&gt; "bar"
2.0.0-p481 :019 &gt; '#{foo}'
 =&gt; "\#{foo}"
</pre>
</div>
</li>
<li>Ruby中单引号的意义当然不仅仅局限于这一个地方咯.单引号最重要的意义在于''里面
有几个单词,那么就是有几个ascii码字符. 而""里面却有可能是两个字符代表一个ascii
<div class="org-src-container">

<pre class="src src-ruby">2.0.0-p481 :020 &gt; "\n"
 =&gt; "\n"
2.0.0-p481 :021 &gt; '\n'
 =&gt; "\\n"
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2-5" class="outline-4">
<h4 id="sec-4-2-5">Objects and message passing</h4>
<div class="outline-text-4" id="text-4-2-5">
<ul class="org-ul">
<li>在ruby中,所有的一切都是对象(包括string和nil)
<div class="org-src-container">

<pre class="src src-ruby">irb(main):001:0&gt; "foobar".length
"foobar".length
=&gt; 6
irb(main):002:0&gt; "foobar".empty?
"foobar".empty?
=&gt; false
irb(main):003:0&gt; s = "foobar"
s = "foobar"
=&gt; "foobar"irb(main):001:0&gt; "foobar".length
"foobar".length
=&gt; 6
irb(main):002:0&gt; "foobar".empty?
"foobar".empty?
=&gt; false
irb(main):003:0&gt; s = "foobar"
s = "foobar"
=&gt; "foobar"
</pre>
</div>
</li>
<li>nil是最奇怪的对象, nil并不是empty,是一种特殊的存在,我们可以测试一个对象是
不是nil,通过nil?函数
<div class="org-src-container">

<pre class="src src-ruby">irb(main):001:0&gt; "foo".nil?
"foo".nil?
=&gt; false
irb(main):002:0&gt; "".nil?
"".nil?
=&gt; false
irb(main):004:0&gt; nil.nil?
=&gt; true
</pre>
</div>
</li>
<li>nil是false,其他所有都是true,甚至0都是false!
<div class="org-src-container">

<pre class="src src-ruby">irb(main):002:0&gt; puts "zero is true" if 0
puts "zero is true" if 0
zero is true
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2-6" class="outline-4">
<h4 id="sec-4-2-6">Method definitions</h4>
<div class="outline-text-4" id="text-4-2-6">
<ul class="org-ul">
<li>ruby代码的最后一行是"隐形返回值"
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2-7" class="outline-4">
<h4 id="sec-4-2-7">Back to the title helper</h4>
<div class="outline-text-4" id="text-4-2-7">
<ul class="org-ul">
<li>我们来看看full_title的代码
<div class="org-src-container">

<pre class="src src-ruby">module ApplicationHelper
  # Returns the full title on a per-page basis
  def full_title(page_title)
    base_title = "Ruby on Rails Tutorial Sample App"
    if page_title.empty?
      base_title
    else
      "#{base_title} | #{page_title}"
    end
  end
end
</pre>
</div>
</li>
<li>这里的full_tilte被写入了一个叫做ApplicationHelper的module,这个module会作为
一个整体被include到其他ruby代码里面,然后发挥作用.
</li>
<li>在rails里面,我们不需要明确的include,框架本身已经帮我们include了
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">Other data structures</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1">Arrays and ranges</h4>
<div class="outline-text-4" id="text-4-3-1">
<ul class="org-ul">
<li>split可以把字符串改成数组
<div class="org-src-container">

<pre class="src src-ruby">irb(main):003:0&gt; "foo bar     baz".split
"foo bar     baz".split
=&gt; ["foo", "bar", "baz"]
irb(main):004:0&gt; "fooxbarxbaz".split
"fooxbarxbaz".split
=&gt; ["fooxbarxbaz"]
irb(main):005:0&gt; "fooxbarxbaz".split('x')
"fooxbarxbaz".split('x')
=&gt; ["foo", "bar", "baz"]
</pre>
</div>
</li>
<li>x..x就是一个数组,range可以使用to_a来创建数组
<div class="org-src-container">

<pre class="src src-ruby">irb(main):006:0&gt; (0..9).to_a
(0..9).to_a
=&gt; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
</pre>
</div>
</li>
<li>range还可以作为数组的index
<div class="org-src-container">

<pre class="src src-ruby">irb(main):007:0&gt; a = %w[foo bar baz quux]
a = %w[foo bar baz quux]
=&gt; ["foo", "bar", "baz", "quux"]
irb(main):008:0&gt; a[0..2]
a[0..2]
=&gt; ["foo", "bar", "baz"]
</pre>
</div>
</li>
<li>ruby里面创建random的域名的函数如下(主要就是利用了range)
<div class="org-src-container">

<pre class="src src-ruby">irb(main):009:0&gt; ('a'..'z').to_a
('a'..'z').to_a
=&gt; ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"]
irb(main):010:0&gt; ('a'..'z').to_a.shuffle
('a'..'z').to_a.shuffle
=&gt; ["k", "q", "d", "g", "r", "v", "x", "y", "u", "n", "f", "s", "c", "l", "w", "b", "a", "e", "m", "t", "p", "h", "j", "z", "i", "o"]
irb(main):011:0&gt; ('a'..'z').to_a.shuffle[0..7]
('a'..'z').to_a.shuffle[0..7]
=&gt; ["n", "q", "h", "d", "j", "z", "t", "v"]
irb(main):012:0&gt; ('a'..'z').to_a.shuffle[0..7].join  # final solution
('a'..'z').to_a.shuffle[0..7].join
=&gt; "qfdlgxek"
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2">Blocks</h4>
<div class="outline-text-4" id="text-4-3-2">
<ul class="org-ul">
<li>数组和range都有一系列的函数可以使用block作为自己的参数
</li>
<li>而block,则是ruby里面最难以理解的概念
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3">Hashes and symbols</h4>
<div class="outline-text-4" id="text-4-3-3">
<ul class="org-ul">
<li>其实hash就是array的变体,只不过不仅仅能使用integer来作为index罢了. 在Perl里
面Hash又叫做"associative array"
<div class="org-src-container">

<pre class="src src-ruby">irb(main):013:0&gt; user = {}
user = {}
=&gt; {}
irb(main):014:0&gt; user["first_name"] = "Michael"
user["first_name"] = "Michael"
=&gt; "Michael"
irb(main):016:0&gt; user["last_name"]="Hartl"
user["last_name"]="Hartl"
=&gt; "Hartl"
irb(main):017:0&gt; user["first_name"]
user["first_name"]
=&gt; "Michael"
irb(main):018:0&gt; user
user
=&gt; {"first_name"=&gt;"Michael", "last_name"=&gt;"Hartl"}
</pre>
</div>
</li>
<li>虽然可以使用各种object作为key,但是,在rails甚至是ruby里面,使用symbol作为
index是一种"更为常规"的做法, symbol有"ruby中的enum"的称号.
<div class="org-src-container">

<pre class="src src-ruby">irb(main):002:0&gt; h1 = {:name=&gt;"Michael Hartl", :email=&gt;"michael@example.com"}
h1 = {:name=&gt;"Michael Hartl", :email=&gt;"michael@example.com"}
=&gt; {:name=&gt;"Michael Hartl", :email=&gt;"michael@example.com"}
</pre>
</div>
</li>
<li>由于在ruby里面基本作用就是hash的key,所以ruby甚至为它创建了更简单的定义方法
<div class="org-src-container">

<pre class="src src-ruby">irb(main):001:0&gt; h1 = {name: "Michael Hartl", email: "michael@example.com"}
h1 = {name: "Michael Hartl", email: "michael@example.com"}
=&gt; {:name=&gt;"Michael Hartl", :email=&gt;"michael@example.com"}
</pre>
</div>
</li>
<li>hash和数组,range一样,也有很多使用block作为参数的函数, 只不过返回两个成员
<div class="org-src-container">

<pre class="src src-ruby">irb(main):004:0&gt; flash.each {|key, value| puts "key is #{key}, value is #{value}"}
flash.each {|key, value| puts "key is #{key}, value is #{value}"}
key is success, value is It worked!
key is error, value is It failed.
=&gt; {:success=&gt;"It worked!", :error=&gt;"It failed."}
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4">CSS revisited</h4>
<div class="outline-text-4" id="text-4-3-4">
<ul class="org-ul">
<li>上面我们设置css的时候,使用了如下的代码
<div class="org-src-container">

<pre class="src src-html">&lt;%= stylesheet_link_tag "application", media: "all",
                                       "data-turbolinks-track" =&gt; true %&gt;
</pre>
</div>
</li>
<li>其实就是一个函数调用, 因为ruby下面函数调用是可以没有括号的,所以下面两个是
相等的
<div class="org-src-container">

<pre class="src src-ruby"># Parentheses on function calls are optional.
stylesheet_link_tag("application", media: "all",
                                   "data-turbolinks-track" =&gt; true)
stylesheet_link_tag "application", media: "all",
                                   "data-turbolinks-track" =&gt; true
</pre>
</div>
</li>
<li>另外media看起来是个hash啊,怎么变成了参数&#x2026;? 原来ruby有如下规定:
<pre class="example">
        如果hash是最后一个参数的话,hash的括号是可以省略的.
</pre>
</li>
<li>所以,下面两个也是等价的
<div class="org-src-container">

<pre class="src src-ruby"># Curly braces on final hash arguments are optional.
stylesheet_link_tag "application", { media: "all",
                                     "data-turbolinks-track" =&gt; true }
stylesheet_link_tag "application", media: "all",
                                   "data-turbolinks-track" =&gt; true
</pre>
</div>
</li>
<li>更搞笑的是下面这句, 由于有"-"的变量不能使用symbol: value的形式,所以,他还是得用老的
<div class="org-src-container">

<pre class="src src-ruby">"data-turbolinks-track" =&gt; true
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4">Ruby classes</h3>
<div class="outline-text-3" id="text-4-4">
</div><div id="outline-container-sec-4-4-1" class="outline-4">
<h4 id="sec-4-4-1">Constructors</h4>
<div class="outline-text-4" id="text-4-4-1">
<ul class="org-ul">
<li>ruby和java一样也是可以使用赋值来创建新的class, 其原理就是内部调用了一次new
<div class="org-src-container">

<pre class="src src-ruby">irb(main):005:0&gt; s = "foobar"
s = "foobar"
=&gt; "foobar"
irb(main):006:0&gt; s.class
s.class
=&gt; String
irb(main):007:0&gt; s1 = String.new("foobar")
s1 = String.new("foobar")
=&gt; "foobar"
irb(main):008:0&gt; s1.class
s1.class
=&gt; String
irb(main):009:0&gt; s1 == "foobar"
s1 == "foobar"
=&gt; true
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-4-2" class="outline-4">
<h4 id="sec-4-4-2">Class inheritance</h4>
<div class="outline-text-4" id="text-4-4-2">
<ul class="org-ul">
<li>我们可以使用superclass来对付处女座
<div class="org-src-container">

<pre class="src src-ruby">irb(main):010:0&gt; s = String.new("foobar")
s = String.new("foobar")
=&gt; "foobar"
irb(main):011:0&gt; s.class
s.class
=&gt; String
irb(main):012:0&gt; s.class.superclass
s.class.superclass
=&gt; Object
irb(main):013:0&gt; s.class.superclass.superclass
s.class.superclass.superclass
=&gt; BasicObject
irb(main):014:0&gt; s.class.superclass.superclass.superclass
s.class.superclass.superclass.superclass
=&gt; nil
</pre>
</div>
</li>
<li>比如我们想创建一个word class, 其有一个判断是否"对称"的功能
<div class="org-src-container">

<pre class="src src-ruby">class Word
  def palindrome?(string)
    string == string.reverse
  end
end

w = Word.new
p w.palindrome?("foobar")
p w.palindrome?("level")

##################################################
# &lt;===================OUTPUT===================&gt; #
# false                                          #
# true                                           #
##################################################
</pre>
</div>
</li>
<li>如果用继承的方法来写就是如下
<div class="org-src-container">

<pre class="src src-ruby">class Word &lt; String
  def palindrome?
    self == self.reverse
  end
end

s = Word.new("level")
p s.palindrome?
p s.length

##################################################
# &lt;===================OUTPUT===================&gt; #
# true                                           #
# 5                                              #
##################################################
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-4-3" class="outline-4">
<h4 id="sec-4-4-3">Modifying built-in classes</h4>
<div class="outline-text-4" id="text-4-4-3">
<ul class="org-ul">
<li>ruby 灵活的地方,还在于可以更改built-in的函数. 比如,下面这个函数肯定是不对的
<div class="org-src-container">

<pre class="src src-ruby">irb(main):014:0&gt; "level".palindrome?
"level".palindrome?
NoMethodError: undefined method `palindrome?' for "level":String
</pre>
</div>
</li>
<li>我们可以如下更改built-in类
<div class="org-src-container">

<pre class="src src-ruby">class String
  def palindrome?
    self == self.reverse
  end
end

"level".palindrome?

##################################################
# &lt;===================OUTPUT===================&gt; #
# true                                           #
##################################################
</pre>
</div>
</li>
<li>一般人不要随便更改built-in的class, rails不算一般,所以它可以更改, 最著名的
更改就是在String里面加了一个blank?函数, blank?函数是判断是否为"无意义的空
字符(用户名就不能只是空格)", 比如tab和space等等, (下面的例子要在rails console
里面才能成功)
<div class="org-src-container">

<pre class="src src-ruby">i309511@[git-svn-ct] &gt; rails c
/Users/i309511/Code/git-svn-ct/lib/content_admin_mixin.rb:93: warning: already initialized constant CONTENT_SEARCH_AUTOCOMPLETE_CLASS_NAMES
Loading development environment (Rails 3.0.20)
irb(main):001:0&gt; "".empty?
=&gt; true
irb(main):002:0&gt; "   ".empty?
=&gt; false
irb(main):003:0&gt; "".blank?
=&gt; true
irb(main):004:0&gt; "   ".blank?
=&gt; true
irb(main):005:0&gt; nil.blank?
=&gt; true
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-4-4" class="outline-4">
<h4 id="sec-4-4-4">A controller class</h4>
<div class="outline-text-4" id="text-4-4-4">
<ul class="org-ul">
<li>下面是demo_app里面的controller继承序列
<div class="org-src-container">

<pre class="src src-ruby">i309511@[sample_app] &gt; rails c
Loading development environment (Rails 4.0.8)
irb(main):001:0&gt; controller = StaticPagesController.new
=&gt; #&lt;StaticPagesController:0x007ff9dce29bf8 @_routes=nil, @_action_has_layout=true, @_headers={"Content-Type"=&gt;"text/html"}, @_status=200, @_request=nil, @_response=nil&gt;
irb(main):002:0&gt; controller.class
=&gt; StaticPagesController
irb(main):003:0&gt; controller.class.superclass
=&gt; ApplicationController
irb(main):004:0&gt; controller.class.superclass.superclass
=&gt; ActionController::Base
irb(main):005:0&gt; controller.class.superclass.superclass.superclass
=&gt; ActionController::Metal
irb(main):006:0&gt; controller.class.superclass.superclass.superclass.superclass
=&gt; AbstractController::Base
irb(main):007:0&gt; controller.class.superclass.superclass.superclass.superclass.superclass
=&gt; Object
</pre>
</div>
</li>
<li>controller明显是一个ruby类,所以我们试着来调用这个类的函数home
<div class="org-src-container">

<pre class="src src-ruby">irb(main):008:0&gt; controller.home
=&gt; nil
</pre>
</div>
</li>
<li>为什么controller不能调用函数?这是因为
<pre class="example">
rails虽然是有ruby写成的,但是其运行方法是自成一体的.所以有些rails的类和ruby类用法一样, 而有些rails的类只不过是rails的魔法而已
</pre>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-4-5" class="outline-4">
<h4 id="sec-4-4-5">A user class</h4>
<div class="outline-text-4" id="text-4-4-5">
<ul class="org-ul">
<li>一个简单的ruby class例子如下
<div class="org-src-container">

<pre class="src src-ruby">class User
  attr_accessor :name, :email

  def initialize(attributes = {})
    @name = attributes[:name]
    @email = attributes[:email]
  end

  def formatted_email
    "#{@name} &lt;#{@email}&gt;"
  end
end
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Chapter 05: Filling in the layout</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Adding some structure</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>我们开始来让界面好看一点.
</li>
<li>首先要更改的是application.html.erb, 这个是所有其他页面都会用的模板
<div class="org-src-container">

<pre class="src src-diff">    Modified   app/views/layouts/application.html.erb
diff --git a/app/views/layouts/application.html.erb b/app/views/layouts/application.html.erb
index c57717a..78407fb 100644
--- a/app/views/layouts/application.html.erb
+++ b/app/views/layouts/application.html.erb
@@ -7,8 +7,21 @@
   &lt;%= csrf_meta_tags %&gt;
 &lt;/head&gt;
 &lt;body&gt;
+  &lt;header class="navbar navbar-fixed-top navbar-inverse"&gt;
+    &lt;div class="navbar-inner"&gt;
+      &lt;%= link_to "sample app", '#', id: "logo"%&gt;
+      &lt;nav&gt;
+        &lt;ul class="nav pull-right"&gt;
+          &lt;li&gt;&lt;%= link_to "Home",      '#' %&gt;&lt;/li&gt;
+          &lt;li&gt;&lt;%= link_to "Help",      '#' %&gt;&lt;/li&gt;
+          &lt;li&gt;&lt;%= link_to "Sign in",   '#' %&gt;&lt;/li&gt;
+        &lt;/ul&gt;
+      &lt;/nav&gt;
+    &lt;/div&gt;
+  &lt;/header&gt;

-&lt;%= yield %&gt;
-
+  &lt;div class="container"&gt;
+    &lt;%= yield %&gt;
+  &lt;/div&gt;
 &lt;/body&gt;
 &lt;/html&gt;
</pre>
</div>
</li>
<li>然后我们来更改其中一个页面home
<div class="org-src-container">

<pre class="src src-diff">    Modified   app/views/static_pages/home.html.erb
diff --git a/app/views/static_pages/home.html.erb b/app/views/static_pages/home.html.erb
index d4f4fe7..a33631c 100644
--- a/app/views/static_pages/home.html.erb
+++ b/app/views/static_pages/home.html.erb
@@ -1,6 +1,11 @@
-&lt;h1&gt;Sample App&lt;/h1&gt;
-&lt;p&gt;
-  This is the ome page for the
-  &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
-  sample application.
-&lt;/p&gt;
+&lt;div class="center hero-unit"&gt;
+  &lt;h1&gt;Sample App&lt;/h1&gt;
+  &lt;h2&gt;
+    This is the ome page for the
+    &lt;a href="http://railstutorial.org/"&gt;Ruby on Rails Tutorial&lt;/a&gt;
+    sample application.
+  &lt;/h2&gt;
+  &lt;%= link_to "Sinnup now!", '#', class: "btn btn-large btn-primay" %&gt;
+&lt;/div&gt;
+
+&lt;%= link_to image_tag("rails.png", alt: "Rails"), 'http://rubyonrails.org/' %&gt;
</pre>
</div>
</li>
<li>然后界面就是这个样子了

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch5/index_with_layout.png" alt="index_with_layout.png" />
</p>
<p><span class="figure-number">Figure 5:</span> index_with_layout</p>
</div>
</li>
<li>上面只是大体位置都有了,我们为header和div创建的class都还没安装呢.安装过程如下:
<ul class="org-ul">
<li>首先更改Gemfile, 这里引入的是bootstrap-saas, 之所以gem名字里面还有个sass,
是因为默认bootstrap是使用LESS的,而Rails是使用SASS的,所以这个gem还负责转换
less到sass
<div class="org-src-container">

<pre class="src src-diff">    Modified   Gemfile
diff --git a/Gemfile b/Gemfile
index 74a49e3..0b1f188 100644
--- a/Gemfile
+++ b/Gemfile
@@ -4,6 +4,8 @@ ruby '2.0.0'

 # Bundle edge Rails instead: gem 'rails', github: 'rails/rails'
 gem 'rails', '4.0.8'
+gem 'bootstrap-sass', '2.3.2.0'
+gem 'sprockets', '2.11.0'

 group :development, :test do
   gem 'sqlite3'
</pre>
</div>
</li>
<li>然后要加上一行,来让bootstrap-sass和rails的asset pipeline兼容
<div class="org-src-container">

<pre class="src src-diff">    Modified   config/application.rb
diff --git a/config/application.rb b/config/application.rb
index ffb130e..85b957a 100644
--- a/config/application.rb
+++ b/config/application.rb
@@ -24,5 +24,6 @@ module SampleApp
     # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.
     # config.i18n.load_path += Dir[Rails.root.join('my', 'locales', '*.{rb,yml}').to_s]
     # config.i18n.default_locale = :de
+    config.assets.precompile += %w(*.png *.jpg *.jpeg *.gif)
   end
 end
</pre>
</div>
</li>
<li>好了,下面是要把css引入到我们的网站,需要重新创建一个文件. 我们发现,我们只
是在assets/stylesheets文件夹下面加个文件,就立马可以加入到网站了? 原因
是assets下面的文件夹叫做asset pipeline,里面所有的文件都会自动导入
<div class="org-src-container">

<pre class="src src-diff">    New        app/assets/stylesheets/custom.css.scss
diff --git a/app/assets/stylesheets/custom.css.scss b/app/assets/stylesheets/custom.css.scss
new file mode 100644
index 0000000..7697a21
--- /dev/null
+++ b/app/assets/stylesheets/custom.css.scss
@@ -0,0 +1 @@
+@import "bootstrap"
</pre>
</div>
</li>
</ul>
</li>
<li>结果就是如图了

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch5/index_with_css_layout.png" alt="index_with_css_layout.png" />
</p>
<p><span class="figure-number">Figure 6:</span> index_with_css_layout</p>
</div>
</li>
<li>下面我们要添加一些scss代码(这些代码最后会转换成css)
<div class="org-src-container">

<pre class="src src-css">@import "bootstrap";

/* universal */

html {
    overflow-y: scroll;
}

body {
    padding-top: 60px;
}

section {
    overflow: auto;
}

textarea {
    resize: vertical;
}

.center {
    text-align: center;
}
.center h1 {
    margin-bottom: 10px;
}
</pre>
</div>
</li>
<li>结果就是下面了

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch5/index_with_css_change.png" alt="index_with_css_change.png" />
</p>
<p><span class="figure-number">Figure 7:</span> index_with_css_change</p>
</div>
</li>
<li>除了第一行外,都是新加的,而且加的,也基本都是css代码,并不需要scss进行转换.关
于这些css,还真有许多要说的:
<ul class="org-ul">
<li>css 在{}前面的这些符号有三种来源:
<ol class="org-ol">
<li>HTML tag : 比如下面设置会让所有body最上面有60像素的间隔
<div class="org-src-container">

<pre class="src src-css">body {
  padding-top: 60px;
}
</pre>
</div>
</li>
<li>id: #logo (后面会看到)
</li>
<li>class: .center: 下面的就会让所有设置center class的成员(比如div)都居中
对齐, 我们在home.html.erb里面,我们就全局定义了center class
<div class="org-src-container">

<pre class="src src-css">.center {
  text-align: center;
}
</pre>
</div>
</li>
</ol>
</li>
</ul>
</li>
<li>然后我们继续改进,增加了文字的大小的style设置
<div class="org-src-container">

<pre class="src src-diff">    Modified   app/assets/stylesheets/custom.css.scss
diff --git a/app/assets/stylesheets/custom.css.scss b/app/assets/stylesheets/custom.css.scss
index 3963868..7348f92 100644
--- a/app/assets/stylesheets/custom.css.scss
+++ b/app/assets/stylesheets/custom.css.scss
@@ -1,5 +1,4 @@
-
-
+@import "bootstrap";

 /* universal */

@@ -24,4 +23,31 @@ textarea {
 }
 .center h1 {
     margin-bottom: 10px;
+}
+
+/* typography */
+
+h1, h2, h3, h4, h5, h6 {
+    line-height: 1,
+}
+
+h1 {
+    font-size: 3em;
+    letter-spacing: -2px;
+    margin-bottom: 30px;
+    text-align: center;
+}
+
+h2 {
+    font-size: 1.2em;
+    letter-spacing: -1px;
+    margin-bottom: 30px;
+    text-align: center;
+    font-weight: normal;
+    color: #999;
+}
+
+p {
+    font-size: 1.1em;
+    line-height: 1.7em;
</pre>
</div>
</li>
<li>然后就如图所示了

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch5/index_with_css_oneline.png" alt="index_with_css_oneline.png" />
</p>
<p><span class="figure-number">Figure 8:</span> index_with_css_oneline</p>
</div>
</li>
<li>上面的class或者html tag都是对"一群"对象的更改, 下面我们来针对某个对象(具有
且只有某个id)来更改它的style
<div class="org-src-container">

<pre class="src src-css">#logo {
  float: left;
  margin-right: 10px;
  font-size: 1.7em;
  color: #fff;
  text-transform: uppercase;
  letter-spacing: -1px;
  padding-top: 9px;
  font-weight: bold;
  line-height: 1;
}

#logo:hover {
  color: #fff;
  text-decoration: none;
}
</pre>
</div>
</li>

<li>效果如下

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch5/index_with_css_big_title.png" alt="index_with_css_big_title.png" />
</p>
<p><span class="figure-number">Figure 9:</span> index_with_css_big_title</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1">Partials</h4>
<div class="outline-text-4" id="text-5-1-1">
<ul class="org-ul">
<li>某一个页面的独大,都不是程序想要看到的,所以,我们要把页面打开,分成几个部分:
<ul class="org-ul">
<li>首先在application.html.erb里面把老的代码去掉,加上新的"部分"标示
<div class="org-src-container">

<pre class="src src-diff">    Modified   app/views/layouts/application.html.erb
diff --git a/app/views/layouts/application.html.erb b/app/views/layouts/application.html.erb
index 78407fb..1a9bfef 100644
--- a/app/views/layouts/application.html.erb
+++ b/app/views/layouts/application.html.erb
@@ -7,21 +7,12 @@
   &lt;%= csrf_meta_tags %&gt;
 &lt;/head&gt;
 &lt;body&gt;
-  &lt;header class="navbar navbar-fixed-top navbar-inverse"&gt;
-    &lt;div class="navbar-inner"&gt;
-      &lt;%= link_to "sample app", '#', id: "logo"%&gt;
-      &lt;nav&gt;
-        &lt;ul class="nav pull-right"&gt;
-          &lt;li&gt;&lt;%= link_to "Home",      '#' %&gt;&lt;/li&gt;
-          &lt;li&gt;&lt;%= link_to "Help",      '#' %&gt;&lt;/li&gt;
-          &lt;li&gt;&lt;%= link_to "Sign in",   '#' %&gt;&lt;/li&gt;
-        &lt;/ul&gt;
-      &lt;/nav&gt;
-    &lt;/div&gt;
-  &lt;/header&gt;
+  &lt;%= render 'layouts/header' %&gt;

   &lt;div class="container"&gt;
     &lt;%= yield %&gt;
+    &lt;%= render 'layouts/footer' %&gt;
+
   &lt;/div&gt;
 &lt;/body&gt;
 &lt;/html&gt;
</pre>
</div>
</li>
<li>然后把header和footer分别创立,注意这里文件名都多了个下划线
<div class="org-src-container">

<pre class="src src-diff">    New        app/views/layouts/_footer.html.erb
diff --git a/app/views/layouts/_footer.html.erb b/app/views/layouts/_footer.html.erb
new file mode 100644
index 0000000..9cc6a71
--- /dev/null
+++ b/app/views/layouts/_footer.html.erb
@@ -0,0 +1,13 @@
+&lt;footer class="footer"&gt;
+  &lt;small&gt;
+    &lt;a href="http://railstutorial.org/"&gt;Rails Tutorial&lt;/a&gt;
+    by Michael Hartl
+  &lt;/small&gt;
+  &lt;nav&gt;
+    &lt;ul&gt;
+      &lt;li&gt;&lt;%= link_to "About",   '#' %&gt;&lt;/li&gt;
+      &lt;li&gt;&lt;%= link_to "Contact", '#' %&gt;&lt;/li&gt;
+      &lt;li&gt;&lt;a href="http://news.railstutorial.org/"&gt;News&lt;/a&gt;&lt;/li&gt;
+    &lt;/ul&gt;
+  &lt;/nav&gt;
+&lt;/footer&gt;
    New        app/views/layouts/_header.html.erb
diff --git a/app/views/layouts/_header.html.erb b/app/views/layouts/_header.html.erb
new file mode 100644
index 0000000..889ace7
--- /dev/null
+++ b/app/views/layouts/_header.html.erb
@@ -0,0 +1,14 @@
+&lt;header class="navbar navbar-fixed-top navbar-inverse"&gt;
+  &lt;div class="navbar-inner"&gt;
+    &lt;div class="container"&gt;
+      &lt;%= link_to "sample app", '#', id: "logo" %&gt;
+      &lt;nav&gt;
+        &lt;ul class="nav pull-right"&gt;
+          &lt;li&gt;&lt;%= link_to "Home",    '#' %&gt;&lt;/li&gt;
+          &lt;li&gt;&lt;%= link_to "Help",    '#' %&gt;&lt;/li&gt;
+          &lt;li&gt;&lt;%= link_to "Sign in", '#' %&gt;&lt;/li&gt;
+        &lt;/ul&gt;
+      &lt;/nav&gt;
+    &lt;/div&gt;
+  &lt;/div&gt;
+&lt;/header&gt;
</pre>
</div>
</li>
<li>最后更改css,增加footer部分的样式
<div class="org-src-container">

<pre class="src src-css">/* footer */

footer {
  margin-top: 45px;
  padding-top: 5px;
  border-top: 1px solid #eaeaea;
  color: #999;
}

footer a {
  color: #555;
}

footer a:hover {
  color: #222;
}

footer small {
  float: left;
}

footer ul {
  float: right;
  list-style: none;
}

footer ul li {
  float: left;
  margin-left: 10px;
}
</pre>
</div>
</li>
</ul>
</li>
<li>最后就是这个样子的了

<div class="figure">
<p><img src="https://raw.githubusercontent.com/harrifeng/org_dot/master/notes/ruby/ch5/index_final.png" alt="index_final.png" />
</p>
<p><span class="figure-number">Figure 10:</span> index_final</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">Sass and the asset pipeline</h3>
<div class="outline-text-3" id="text-5-2">
</div><div id="outline-container-sec-5-2-1" class="outline-4">
<h4 id="sec-5-2-1">The asset pipeline</h4>
<div class="outline-text-4" id="text-5-2-1">
<ul class="org-ul">
<li>asset pipeline是rails处理style的方法,其有三个点比较重要:
<ul class="org-ul">
<li>asset directories
</li>
<li>manifest files
</li>
<li>preprocessor engine
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-5-2-1-1" class="outline-5">
<h5 id="sec-5-2-1-1">Asset directories</h5>
<div class="outline-text-5" id="text-5-2-1-1">
<ul class="org-ul">
<li>在Rails 3.0以前, static assets 存放在public/下面, 也就是
<pre class="example">
public/stylesheets
public/javascripts
public/images
</pre>
</li>
<li>从3.1开始,asset directories改成了下面三个folder
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Place</th>
<th scope="col" class="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">app/assets</td>
<td class="left">assets specific to the present application</td>
</tr>

<tr>
<td class="left">lib/assets</td>
<td class="left">assets for libraries written by your dev tea</td>
</tr>

<tr>
<td class="left">vendor/assets</td>
<td class="left">assets from third-party vendors</td>
</tr>
</tbody>
</table>
</li>
<li>当然了,每个folder下面的subfolder里面的内容,也是pipeline的一部分. 比如,我
们的custom.css.scss就是在app/assets/stylesheets
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-2-1-2" class="outline-5">
<h5 id="sec-5-2-1-2">Manifest files</h5>
<div class="outline-text-5" id="text-5-2-1-2">
<ul class="org-ul">
<li>所谓的manifest就是告诉rails如何导入css, 是把stylesheets里面的全部导入
application.css作为style呢,还是只使用application.css里面的内容
<div class="org-src-container">

<pre class="src src-css">/* app/assets/stylesheets/application.css */

/*
 * This is a manifest file that'll be compiled into application.css, which will include all the files
 * listed below.
 *
 * Any CSS and SCSS file within this directory, lib/assets/stylesheets, vendor/assets/stylesheets,
 * or vendor/assets/stylesheets of plugins, if any, can be referenced here using a relative path.
 *
 * You're free to add application-wide styles to this file and they'll appear at the top of the
 * compiled file, but it's generally better to create a new file per style scope.
 *
 *= require_self
 *= require_tree .
 */
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-2-1-3" class="outline-5">
<h5 id="sec-5-2-1-3">Preprocessorengines</h5>
<div class="outline-text-5" id="text-5-2-1-3">
<ul class="org-ul">
<li>预处理其实是你使用了什么扩展名就用什么方法预处理, 比如:
<ul class="org-ul">
<li>erb
</li>
<li>coffee
</li>
<li>scss
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-2-1-4" class="outline-5">
<h5 id="sec-5-2-1-4">Efficiency in production</h5>
<div class="outline-text-5" id="text-5-2-1-4">
<ul class="org-ul">
<li>这样分开的好处,是rails可以最后把所有的css, js各自合并成一个文件,在生产模
式中会提高效率
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-5-2-2" class="outline-4">
<h4 id="sec-5-2-2">Syntactically awesome stylesheets</h4>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

         <!-- Disqus Comment BEGIN -->
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              var disqus_shortname = 'harrifeng';

              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

         <!-- Disqus Comment END -->
</div>
</body>
</html>
